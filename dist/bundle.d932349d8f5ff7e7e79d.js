(()=>{"use strict";function e(e,t,n,r){const i=document.querySelector(t),o=document.querySelector(e);function a(){i&&o&&(i.classList.remove("active"),n?document.querySelector(n).classList.add("hidden"):o.classList.add("hidden"),r instanceof Function&&r())}document.addEventListener("click",(function(n){n.target.closest("".concat(e,",").concat(t))||a()})),document.addEventListener("keyup",(function(e){"Escape"===e.key&&a()}))}function t(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}class n{constructor(e,t,n,r,i,o={width:"300px",placement:"bottom",delay:200,ignoreClickOutsideClass:!1,position:"absolute"}){this.trigger=e,this.triggerText=t,this.target=n,this.items=r,this.options=o,this.$targetEl=document.querySelector(n),this.$triggerEl=document.querySelector(e),this.triggerText=t,this.callback=i,this.initDropdown()}initDropdown(){this.$targetEl.classList.add(this.options.position),this.$triggerEl.firstChild.textContent=this.triggerText;let n="";this.items.forEach((e=>{"link"===e.type?n+=`\n        <li>\n          <a href="${e.id}" data-value="${e.text}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e.text}</a>\n        </li>\n      `:n+=`\n        <li>\n          <span  data-params="${e.id}" data-value="${e.text}" class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e.text}</span>\n        </li>\n      `})),this.$targetEl.innerHTML=`\n      <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownButton">\n        ${n}\n      </ul>\n    `,this.$triggerEl.addEventListener("click",(e=>{t(this.$triggerEl,"active"),t(this.$targetEl,"hidden")})),this.changeText(),e(this.target,this.trigger)}setValue(e){this.$triggerEl.firstChild.textContent=e}changeText(){this.$targetEl.addEventListener("click",(e=>{e.target instanceof HTMLElement&&e.target.dataset.value&&(this.$triggerEl.firstChild.textContent=e.target.dataset.value,this.callback&&this.callback(e))}))}reset(){this.$triggerEl.firstChild.textContent=this.triggerText}}class r{constructor(e,t){if(this.$root=e,this.listeners=t,!e)throw new Error("No $root provided for DomListenter")}initDOMListeners(){this.listeners.forEach((e=>{const t=e;if(!this[t]){const e=this.name||"";throw new Error(`Method ${t} is not implemented in ${e} Component`)}this[t]=this[t].bind(this),this.$root.on(e,this[t])}))}removeDOMListeners(){this.listeners.forEach((e=>{const t=e;this.$root.off(e,this[t])}))}}class i extends r{constructor(e,t){super(e,t.listeners),this.emitter=t.emitter,this.state=t.state,this.unsubs=[],this.prepare()}prepare(){}toHTML(){return""}init(){this.initDOMListeners()}$emit(e,...t){this.emitter.emit(e,...t)}$on(e,t){const n=this.emitter.subscribe(e,t);this.unsubs.push(n)}destroy(){this.removeDOMListeners(),this.unsubs.forEach((e=>e()))}}function o(e){const t=e.getters.getAllPortfolio(),n=[];return t.forEach((e=>{n.push({id:String(e.id),text:e.name,type:"event"})})),n}function a(e,t,n){return n&&"TQOB"===n?`https://mybroker.storage.bcs.ru/FinInstrumentLogo/${t.moexSecurities[n].filter((t=>t[0]===e))[0][28]}.png`:`https://mybroker.storage.bcs.ru/FinInstrumentLogo/${e}.png`}class d{constructor(){this.props=[]}}function s(e){if(e){const t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")}return 0===e?"0":""}class c{constructor(e){this.options=e}render(){return""}initListeners(e){}}class l extends c{constructor(e,t,n,r){super(r),this.startValue=e,this.currentValue=t,this.count=n,this.value=Number(((this.currentValue-this.startValue)*this.count).toFixed(2)),this.percent=Number((this.value/(this.startValue*this.count)*100).toFixed(2))}render(){let e="";return e=this.percent>0?"text-green-500":this.percent<0?"text-red-500":"text-slate-400",`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white ${e}">${s(this.value)}</span>\n          </span>\n          <span>\n            <span class="block  bg-primary-100 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300 ${e}">${s(this.percent)}%</span>\n            </span>  \n      </div>\n    `}}class u extends c{constructor(e=null,t){super(t),this.value=e}render(){let e=null;return e=this.value?s(this.value.toFixed(2))+" ₽":"-",`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-normal text-gray-900 whitespace-nowrap dark:text-white">${e}</span>\n          </span>\n        \n      </div>\n    `}}class m extends c{constructor(e,t,n){super(t),this.ticker=e;const r=this.options.getters.getMoex()[n].filter((t=>t.ticker===e))[0];this.name=r.name,this.currentPrice=r.price,this.dayChange=r.open-r.price,this.logo=a(e)}render(){return`\n    <div class="">\n      <a href="#" target="_blank" class="flex items-center">\n        <span class="w-auto h-8 mr-3 ">\n          <img src=${this.logo} width="22" width="22" height="22" class="min-w-[22px] rounded-full">\n        </span>\n        <span>\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.name}</span>\n          <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${this.ticker}</span>\n          </span>  \n      </a>\n    </div>\n  `}}class x extends c{constructor(e=1,t){super(t),this.value=e}render(){let e="";return this.value>0&&(e=`<div class="">\n      <span class="w-auto block mr-3">\n      <span class="block font-normal text-gray-900 whitespace-nowrap dark:text-white">${s(this.value)} шт. </span>\n      </span>\n     \n  </div>`),e}}class h extends c{constructor(e=null,t=null,n,r=0){super(n),this.single=e,this.count=t,this.value=this.single*this.count,r&&(this.value+=r),this.value=Number(this.value.toFixed(2))}render(){return`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.value?s(this.value)+" ₽":""}</span>          </span>\n          <span>\n            <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${s(this.single.toFixed(2))} ₽</span>\n            </span>  \n      </div>\n    `}}class p extends c{constructor(e,t,n,r,i){super(r),this.ticker=e;const o=this.options.getters.getMoex()[i].filter((t=>t.ticker===e))[0];this.name=o.name,this.currentPrice=o.price*o.nominal/100,this.dayChange=o.open-o.price,this.logo=a(e,r,i),this.initData(n,o,t)}initData(e,t,n){return r=this,i=void 0,a=function*(){e&&e.length&&this.options.getters.getCurrency(e)&&(this.currentPrice=this.currentPrice*this.options.getters.getCurrency(e))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function d(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,d)}s((a=a.apply(r,i||[])).next())}));var r,i,o,a}render(){return`\n    <div class="">\n      <a href="#" target="_blank" class="flex items-center">\n        <span class="w-auto h-8 mr-3 ">\n          <img src=${this.logo} width="22" width="22" height="22" class="min-w-[22px] rounded-full">\n        </span>\n        <span>\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.name}</span>\n          <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${this.ticker}</span>\n          </span>  \n      </a>\n    </div>\n  `}}function I(e,t,n,r,i,o,a,d,s){return`\n    <div class="w-full  mb-4 ${s}" ${i}>\n        <label for="${e}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">${n}</label>\n        <input ${o} step="0.000000001" value="${r}"  type="${t}" name="${e}" id="${e}" autocomplete="off" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="${a}" >\n        ${d||""}\n    </div>\n  `}var f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class g{constructor(e,t,n,r){this.state=t,this.onSubmit=n,this.modaldata=r,this.$el=document.querySelector(e),this.isvalid=!1,this.category=this.state.getters.getCategory(this.state.defaultPortfolio)}initMarketData(){return f(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initForm(){return f(this,void 0,void 0,(function*(){const e=document.createElement("form");e.setAttribute("id","createForm"),this.$el.insertAdjacentElement("beforeend",e);const t=yield this.renderMode();e.insertAdjacentHTML("afterbegin",function(e){return`\n        <div id="modalLoader" class="hidden loader absolute w-full h-full flex items-center justify-center left-0 right-0 top-0 bottom-0 z-40 bg-[rgba(233,233,233,0.2)]">\n          <div role="status">\n              <svg aria-hidden="true" class="w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>\n                  <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>\n              </svg>\n              <span class="sr-only">Loading...</span>\n          </div>\n        </div>\n      ${e}\n     </div>\n  `}(t)),this.postInit(),this.changeFields(),this.initFormSubmit()}))}changeForm(e){const t=document.querySelector(".loader");e?t.classList.remove("hidden"):t.classList.add("hidden")}addVisible(e){const t=document.querySelector(e);t&&t.classList.remove("hidden")}removeVisible(e){const t=document.querySelector(e);t&&t.classList.add("hidden")}changeFields(){"bonds"==={TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[this.category].type?(this.removeVisible('[data-input="stopValue"]'),this.addVisible('[data-input="nkd"]'),this.addVisible('[data-input="stopValue"]')):(this.addVisible('[data-input="stopValue"]'),this.removeVisible('[data-input="nkd"]'),this.removeVisible('[data-input="stopValue"]'))}calcCurrency(){const e=document.querySelector('[data-input="currencyValue"]'),t=e.querySelector("input"),n=this.currentItem.currency;n&&"SUR"!==n?(e.classList.remove("hidden"),t.value=String(this.state.getters.getCurrency(n))):(e.classList.add("hidden"),t.value="1")}calc(e,t){let n=0,r=0,i=0;const o=document.querySelector('input[name="price"]'),a=document.querySelector('input[name="stop"]'),d=document.querySelector('input[name="count"]'),c=document.querySelector('[data-result="total"]'),l=document.querySelector('input[name="nkd"]'),u=document.querySelector("#portfolio").value;if(this.currentPortfolio=u,""===e)return o.value="",a.value="",d.value="",void(c.textContent="0");if(t){const e=this.currentItem.nominal,t=this.state.getters.getCurrency(this.currentItem.currency),i=this.currentItem.price*Number(t)*(e>1?Number(e)/100:1);n=.98*Number(this.currentItem.price),r=Math.round(this.state.getters.getPortfolioSumm(u)/Number(i)),c.textContent=s(String((i*r).toFixed(2)))}else Number(o.value),n=Number(a.value),r=Number(d.value);o.value=String(this.currentItem.price),d.value=String(r),a.value=String(n.toFixed(2)),l.value=String(this.currentItem.nkd)}initFormListeners(){this.$el.querySelectorAll('input[data-calc="totalprice"]').forEach((e=>{e.addEventListener("input",(e=>{this.currentTicker&&this.calc(this.currentTicker,!1)}))})),this.$el.querySelector('[name="category"]').addEventListener("change",(e=>f(this,void 0,void 0,(function*(){this.category=e.target.value,this.changeForm(!0),yield this.initMarketData(),this.changeFields(),this.changeForm(!1)}))))}initFormSubmit(){}renderMode(){return f(this,void 0,void 0,(function*(){return""}))}renderName(e){return I("name","text","Наименование",e||"","","readonly","Наименование")}renderPrice(e){return I("price","number","Цена покупки",e||"0","",'data-calc="totalprice"',"Цена")}renderNkd(e){return I("nkd","number","НКД",e||"0",'data-input="nkd"','data-calc="totalprice"',"НКД","","hidden")}renderCount(e){return I("count","number","Количество",e||"1",'data-input="count"','data-calc="totalprice"',"Количество")}renderStop(e){return I("stop","number","Стоп-лосс",e||"0",'data-input="stopValue"','data-calc=""',"Стоп-лосс")}renderCurrency(e){return I("currencyValue","number","Валюта в момент сделки",e||"1",'data-input="currencyValue"','data-calc="totalprice"',"Курс валюты","","hidden")}renderDescription(e){return`\n    <div class="sm:col-span-2 mb-4"${e||""}>\n        <label for="${t="description"}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Комментарии</label>\n        <textarea id="${t}" undefined  rows="4" class="block p-1 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Примечание">undefined</textarea>\n    </div>\n  `;var t}renderSalePrice(e){return I("salePrice","number","Цена продажи",e||"0","",'data-calc="totalprice"',"Цена")}renderSaleNkd(e){return I("saleNkd","number","НКД",e||"0",'data-input="nkd"','data-calc="totalprice"',"НКД","","hidden")}renderSaleCount(e){return I("saleCount","number","Количество",e||"1",'data-input="count"','data-calc="totalprice"',"Количество")}renderSaleCurrency(e){return I("saleCurrency","number","Валюта в момент сделки",e||"1",'data-input="currencyValue"','data-calc="totalprice"',"Курс валюты","","hidden")}}var y=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class k extends g{constructor(e,t,n,r){super(e,t,n,r),this.state=t,this.onSubmit=n,this.modaldata=r}static create(e,t,n,r){return y(this,void 0,void 0,(function*(){const i=new k(e,t,n,r);return yield i.initMarketData(),i}))}initMarketData(){return y(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>y(this,void 0,void 0,(function*(){e.preventDefault();const t=new FormData(this.$el.querySelector("form"));let n=null;n=D(this.category,t,this.state.moexSearch.moexSecurities,this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,this.modaldata?this.modaldata.id:null),this.onSubmit(this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,n,Boolean(t.get("isclone")),this.category)}))))}renderMode(){return y(this,void 0,void 0,(function*(){let e="",t=null;return this.modaldata&&(t=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(t.ticker)+'\n  <div class="flex items-center mb-4" data-input="clone" data-mode=""  data-mode-create="" data-mode-edit="">\n      <input id="isclone" name="isclone" type="checkbox" value="isclone"\n          class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-500 dark:border-gray-600 " />\n\n      <label for="isclone" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 cursor-pointer">\n          Clone ?\n      </label>\n  </div>'+this.renderPrice(t.buyPrice)+this.renderCount(t.count)+this.renderNkd(t.nkd)+this.renderCurrency(t.buyCurrency)+this.renderStop(t.myStop),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var b=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class v extends g{constructor(e,t,n,r){super(e,t,n,r),this.state=t,this.onSubmit=n,this.modaldata=r}static create(e,t,n,r){return b(this,void 0,void 0,(function*(){const i=new v(e,t,n,r);return yield i.initMarketData(),i}))}initMarketData(){return b(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>b(this,void 0,void 0,(function*(){e.preventDefault();const t=new FormData(this.$el.querySelector("form"));let n=null;n=D(this.category,t,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,n)}))))}renderMode(){return b(this,void 0,void 0,(function*(){let e="",t=null;return this.modaldata&&(t=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(t.ticker)+this.renderPrice(t.buyPrice)+this.renderCount(t.count)+this.renderNkd(t.nkd)+this.renderCurrency(t.buyCurrency)+this.renderStop(t.myStop),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var T=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class B extends g{constructor(e,t,n,r){super(e,t,n,r),this.state=t,this.onSubmit=n,this.modaldata=r}static create(e,t,n,r){return T(this,void 0,void 0,(function*(){const i=new B(e,t,n,r);return yield i.initMarketData(),i}))}initMarketData(){return T(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>T(this,void 0,void 0,(function*(){e.preventDefault();const t=new FormData(this.$el.querySelector("form"));let n=null;n=D(this.category,t,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,n)}))))}renderMode(){return T(this,void 0,void 0,(function*(){let e="",t=null;return this.modaldata&&(t=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(t.ticker),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var w=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class P extends g{constructor(e,t,n,r){super(e,t,n,r),this.state=t,this.onSubmit=n,this.modaldata=r}static create(e,t,n,r){return w(this,void 0,void 0,(function*(){const i=new P(e,t,n,r);return yield i.initMarketData(),i}))}initMarketData(){return w(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>w(this,void 0,void 0,(function*(){e.preventDefault();const t=new FormData(this.$el.querySelector("form"));let n=null;n=function(e,t,n,r,i){const o=n.filter((e=>e[0]===String(t.get("name"))))[0];let a=1;({TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}})[e].nominalIndex&&(a=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].nominalIndex]);const d=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].currencyIndex],s=Number(t.get("price")),c=Number(t.get("currencyValue"))?Number(t.get("currencyValue")):1;return{ticker:String(t.get("name")),type:{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type,market:e,buyPrice:s,count:Number(t.get("count")),buyCurrency:c,currency:d,nominal:a,nkd:Number(t.get("nkd"))||0,positionId:i,portfolioId:String(r),saleCount:Number(t.get("saleCount")),salePrice:Number(t.get("salePrice")),saleCurrency:Number(t.get("saleCurrency")),saleNkd:Number(t.get("saleNkd"))}}(this.category,t,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,n,Boolean(t.get("isclone")),this.category)}))))}renderMode(){return w(this,void 0,void 0,(function*(){let e="",t=null;return this.modaldata&&(t=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(t.ticker)+this.renderSalePrice(t.buyPrice)+this.renderSaleCount(t.count)+this.renderSaleNkd(t.nkd)+this.renderSaleCurrency(t.buyCurrency),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var _=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class Q extends c{constructor(e,t){super(t),this.itemInfo=e}initListeners(t){this.emitter=t;const n={id:this.itemInfo.positionId,ptf:this.itemInfo.portfolioId,market:this.itemInfo.marketId},r=document.querySelector(`#button_position${this.itemInfo.positionId}`),i=document.querySelector(`#menu_position${this.itemInfo.positionId}`);r.addEventListener("click",(e=>{i.classList.remove("hidden")})),document.querySelector(`[data-buypos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>_(this,void 0,void 0,(function*(){const e=yield k.create("#modalContent",this.options,this.onBuy.bind(this),n);t.emit("modal:renderModal",{title:"Buy position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-editpos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>_(this,void 0,void 0,(function*(){const e=yield v.create("#modalContent",this.options,this.onEdit.bind(this),n);t.emit("modal:renderModal",{title:"Edit position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-deletepos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>_(this,void 0,void 0,(function*(){const e=yield B.create("#modalContent",this.options,this.onDelete.bind(this),n);t.emit("modal:renderModal",{title:"Delete position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-salepos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>_(this,void 0,void 0,(function*(){const e=yield P.create("#modalContent",this.options,this.onSale.bind(this),n);t.emit("modal:renderModal",{title:"Sale position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),e(`#menu_position${this.itemInfo.positionId}`,`#button_position${this.itemInfo.positionId}`)}onBuy(e,t,n,r){this.options.actions.addPosition(e,t,n,r),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onEdit(e,t){this.options.actions.editPosition(this.itemInfo.portfolioId,t),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onDelete(e,t){this.options.actions.deletePosition(this.itemInfo.portfolioId,t),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onSale(e,t){this.options.actions.salePosition(this.itemInfo.portfolioId,t),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}render(){return`\n      <div class="flex relative">\n        <button id="button_position${this.itemInfo.positionId}" data-dropdown-toggle="dropdown" class="text-white bg-slate-500 hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-1 py-2.5 text-center inline-flex items-center dark:bg-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-800 w-10 justify-center" type="button"> \n          <svg class="w-2.5 h-2.5 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">\n          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>\n          </svg>\n      </button>\n      \n      <div id="menu_position${this.itemInfo.positionId}" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 absolute top-full right-0">\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-buypos="${this.itemInfo.positionId}" >Купить</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-salepos="${this.itemInfo.positionId}">Продать</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-editpos="${this.itemInfo.positionId}">Изменить</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-deletepos="${this.itemInfo.positionId}">Удалить</div>\n      </div>\n    </div>\n    `}}class C{constructor(e,t,n,r,i,o,a,d,s=null,c=null,I=0,f=1,g,y,k,b){this.options=g,this.type=n,"stock"===this.type&&(this.stock=new m(e,g,t)),"bonds"===this.type&&(this.stock=new p(e,o,a,g,t)),r=r*(o?o/100:1)*(d||1),this.startPrice=new u(r,g),this.change=new l(r,this.stock.currentPrice,i,g),this.nominal=o,this.count=new x(i,g),this.currentPrice=new h(this.stock.currentPrice,i,g),this.myStop=new u(s,g),this.salePrice=new h(c,null,g),this.comm=this.startPrice.value*i*f/100,this.nkd=I*i;const v=Number(I*i+Number(this.comm));this.comm=new u(this.comm,g),this.nkd=new u(this.nkd,g),this.startTotal=new h(r,i,g,v),this.positionControl=new Q({positionId:y,portfolioId:k,marketId:b},g)}static createPosition(e,t,n,r,i){const o=[];return e.forEach((e=>{e.isSold||o.push(new C(e.ticker,i,n,e.buyPrice,e.count,e.nominal,e.currency,e.buyCurrency,e.myStop,null,e.nkd,r,t,e.positionId,e.portfolioId,i))})),o}}class S{constructor(e,t,n,r=[],i){this.id=e,this.name=t,this.depo=n,this.positions=r,this.comm=i}buyStock(e){this.positions.push(e)}}const $={moex:[],portfolio:[{id:"1",name:"Среднесрочный портфель",depo:45e4,comm:.09,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[{positionId:"1",portfolioId:"1",ticker:"HYDR",type:"stock",market:"TQBR",buyPrice:.267,count:416e3,myStop:0}],TQCB:[],TQOB:[]}},{id:"2",name:"Долгосрочный портфель",depo:2e5,comm:.09,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[{positionId:"2",portfolioId:"2",ticker:"ASTR",type:"stock",market:"TQCB",buyPrice:210,count:178},{positionId:"3",portfolioId:"2",ticker:"SNGSP",type:"stock",market:"TQCB",buyPrice:22,count:1e3,myStop:0}],TQCB:[],TQOB:[]}},{id:"3",name:"Портфель облигаций",depo:5e5,comm:.095,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[],TQCB:[{positionId:"6",portfolioId:"3",ticker:"RU000A105A95",type:"bonds",market:"TQCB",nkd:10,buyPrice:40,count:1,nominal:1e3,currency:"USD",buyCurrency:90},{positionId:"7",portfolioId:"3",ticker:"RU000A107B43",type:"bonds",market:"TQCB",nkd:13,buyPrice:54,count:2,nominal:1e3,currency:"USD",buyCurrency:92},{positionId:"8",portfolioId:"3",ticker:"RU000A107B43",type:"bonds",nkd:11,market:"TQCB",buyPrice:64,count:1,nominal:1e3,currency:"USD",buyCurrency:88}],TQOB:[{positionId:"9",portfolioId:"3",ticker:"SU26238RMFS4",type:"bonds",market:"TQOB",buyPrice:45,count:50,nominal:1e3,currency:"",nkd:7}]}}]};var L=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};const E=()=>{const e=$.portfolio.filter((e=>e.id===M.currentDataID)),t=JSON.parse(localStorage.getItem("moexdata"));return{columns:[{title:"Актив",cell:"stock",footer:"Всего"},{title:"Количество",cell:"count",footer:s(("count",e.reduce(((e,t)=>{let n=0;return Object.keys(t.markets).map((e=>{const r=t.markets[e];return r.length<1?0:(r.forEach((e=>{const t=e.count;"number"==typeof t&&(n+=t)})),n)})),n}),0)))+" шт"},{title:"Средняя цена",cell:"startPrice",footer:""},{title:"НКД",cell:"nkd",footer:""},{title:"Комиссия",cell:"comm",footer:""},{title:"Вложено",cell:"startTotal",footer:s(("buyPrice","count",e.reduce(((e,t)=>{let n=0;return Object.keys(t.markets).map((e=>{const r=t.markets[e];return r.length<1?0:(r.forEach((e=>{const t=e.buyPrice,r=e.count;"number"==typeof t&&"number"==typeof r&&(n+=t*r)})),n)})),n}),0)).toFixed(2))+" ₽"},{title:"Текущая стоимость",cell:"currentPrice",footer:s(function(e,n){let r=0;return console.log($),Object.keys(t).map((e=>{const n=t[e];return n.length<1?0:(n.forEach((e=>{const t=e.price,n=e.count;console.log(n),"number"==typeof t&&"number"==typeof n&&(r+=t*n)})),r)})),r}())},{title:"Прибыль",cell:"change",footer:""},{title:"",cell:"change",footer:""},{title:"",cell:"positionControl",footer:""}]}};class M{constructor(){this.mutations={changeBroker:e=>{this.currentPortfolio=[],e&&this.currentPortfolio.push(this.getters.getPortfolioById(e))},addPosition:(e,t,n,r)=>{const i=this.portfolio.filter((t=>t.id===e))[0],o=i.markets[r].filter((e=>e.positionId===t.positionId));if(n||!o.length)i.markets[r].push(t);else{const e=o[0];e.buyPrice=(t.buyPrice*t.count+e.buyPrice*e.count)/(t.count+e.count),e.count+=t.count}},sellPosition:(e,t,n,r)=>{const i=this.portfolio.filter((t=>t.id===e))[0],o=i.markets[r].filter((e=>e.positionId===t.positionId));if(n||!o.length)i.markets[r].push(t);else{const e=o[0];e.buyPrice=-(t.buyPrice*t.count+e.buyPrice*e.count)/(t.count+e.count),e.count+=t.count}},editPosition:(e,t)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((n=>{n.markets[e].forEach((e=>{e.positionId===t.positionId&&(e.buyPrice=t.buyPrice,e.count=t.count,e.myStop=t.myStop,e.buyCurrency=t.buyCurrency,e.nkd=t.nkd)}))}))}))},salePosition:(e,t)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((n=>{n.markets[e].forEach((e=>{e.positionId===t.positionId&&(e.saleCount=t.saleCount,e.salePrice=t.salePrice,e.saleCurrency=t.saleCurrency,e.saleNkd=t.saleNkd,e.count-=t.saleCount,0===e.count&&(e.isSold=!0))}))}))}))},deletePosition:(e,t)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((n=>{n.markets[e]=n.markets[e].filter((e=>e.positionId!==t.positionId))}))}))}},this.getters={getAllPortfolio:()=>this.portfolio,getPortfolio:e=>this.portfolio.filter((t=>t.name===e))[0],getPortfolioId:e=>this.portfolio.filter((t=>t.name===e))[0].id,getPortfolioById:e=>this.portfolio.filter((t=>t.id===e))[0],getPortfolioComm:e=>this.portfolio.filter((t=>t.name===e))[0].comm,getPortfolioSumm:e=>this.portfolio.filter((t=>t.id===e))[0].defaultSumm,getPortfolioDepo:e=>this.portfolio.filter((t=>t.name===e))[0].depo,getCategory:e=>this.portfolio.filter((t=>t.id===e))[0].defaultCategory,getPositionCount:(e,t)=>{const n=this.portfolio.filter((e=>e.id===t))[0];console.log(n)},getPortfolioPositions:(e,t=this.defaultCategory)=>this.portfolio.filter((t=>t.name===e))[0].markets[t],getAllTickers:e=>{const t=[];return this.portfolio.forEach((n=>{n.markets[e].forEach((e=>t.push(e.ticker)))})),{[e]:t}},getPositionById:e=>{const t=Object.keys(this.moex);let n=null;return t.forEach((t=>{this.portfolio.forEach((r=>{r.markets[t].forEach((t=>{t.positionId===e&&(n=t)}))}))})),n},getPortfolioByPositionId:e=>this.getters.getPositionById(e).portfolioId,getCurrent:()=>this.currentPortfolio,getMoexSecurities:()=>this.moexSecurities,getMoexMarketData:()=>this.moexMarketData,getMoexByName:e=>{const t=e.toLocaleLowerCase();return this.moexSearch.moexSecurities.filter((e=>{const n=function(e){var t,n,r;return String(null!==(t=e[20])&&void 0!==t?t:"")+String(null!==(n=e[28])&&void 0!==n?n:"")+String(null!==(r=e[29])&&void 0!==r?r:"")}(e);return e[0].toLocaleLowerCase().includes(t)||e[2].toLocaleLowerCase().includes(t)||n.toLocaleLowerCase().includes(t)}))},getCurrency:e=>{const t=this.currency.filter((t=>t.id===e));return t&&t[0]?t[0].value:1},getMoexSearch:()=>this.moexSearch,getData_moex:(e,t,n)=>{const r={ticker:e,name:this.getters.getName_moex(e,t),fullname:this.getters.getFullName_moex(e,t),engname:this.getters.getEngName_moex(e,t),price:this.getters.getPrice_moex(e,t),startPrice:this.getters.getStartPrice_moex(e,t),currency:this.getters.getCurrency_moex(e,t),nominal:this.getters.getNominal_moex(e,t),nkd:this.getters.getNKD_moex(e,t)};return n.reduce(((e,t)=>(e[t]=r[t],e)),{})},getPrice_moex:(e,t)=>{const n=this.moexSearch.moexMarketData.filter((t=>t[0]===e))[0];return Number(n[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].priceIndex_1]?n[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].priceIndex_1]:n[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].priceIndex_2])},getName_moex:(e,t)=>this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].nameIndex],getFullName_moex:(e,t)=>this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].fnameIndex],getEngName_moex:(e,t)=>this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].engnameIndex],getStartPrice_moex:(e,t)=>Number(this.moexSearch.moexMarketData.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].openPriceIndex]),getNKD_moex:(e,t)=>Number(this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].nkdIndex]),getCurrency_moex:(e,t)=>this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].currencyIndex],getCurrencyValue_moex:(e,t)=>this.getters.getCurrency(this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].currencyIndex])||1,getNominal_moex:(e,t)=>Number(this.moexSearch.moexSecurities.filter((t=>t[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[t].nominalIndex])||1,getMoex:()=>this.moex},this.actions={getAction(e){return this[e]},createPositions:(e,t)=>{const n=[];return e.forEach((e=>{let r=[];M.portfolioName=e.name,t.marketList.forEach((n=>{const i=function(e){return{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type}(n);if(e.markets[n]&&e.markets[n].length){const o=new S(e.id,e.name,e.depo,C.createPosition(e.markets[n],t,i,e.comm,n),e.comm);r=r.concat(o.positions)}})),n.push({name:M.portfolioName,positions:r})})),n},initMoex:()=>L(this,void 0,void 0,(function*(){return this.marketList=Object.keys(this.moex),yield Promise.all(this.marketList.map((e=>L(this,void 0,void 0,(function*(){const t=this.getters.getAllTickers(e);if(t[e].length){const n=yield R(e,t[e]);return this.moex[e]=n.items,this.moexSecurities[e]=n.moexSecurities,this.moexMarketData[e]=n.moexMarketData,this.moex}}))))),Object.assign({},this.moex)})),initSearch:e=>L(this,void 0,void 0,(function*(){return this.moexSearch=yield R(e,[]),Object.assign({},this.moexSearch)})),initCurrency:()=>L(this,void 0,void 0,(function*(){return this.currency=yield async function(){return await fetch("//www.cbr-xml-daily.ru/daily_json.js").then((e=>e.json())).then((e=>Object.keys(e.Valute).map((t=>({id:t,value:e.Valute[t].Value}))))).catch((e=>(console.error("Ошибка при получении данных: ",e),[])))}(),[...this.currency]})),changeBroker:e=>{this.mutations.changeBroker(e)},addPosition:(e,t,n,r)=>{this.mutations.addPosition(e,t,n,r)},sellPosition:(e,t,n,r)=>{this.mutations.sellPosition(e,t,n,r)},editPosition:(e,t)=>{this.mutations.editPosition(e,t)},deletePosition:(e,t)=>{this.mutations.deletePosition(e,t)},salePosition:(e,t)=>{this.mutations.salePosition(e,t)}},this.portfolio=$.portfolio,this.defaultPortfolio=this.portfolio[0].id,this.defaultCategory=this.portfolio[0].defaultCategory,this.currency=[],this.moex={TQBR:[],TQCB:[],TQOB:[]},this.moexSecurities={TQBR:[],TQCB:[],TQOB:[]},this.moexMarketData={TQBR:[],TQCB:[],TQOB:[]},this.moexSearch={TQBR:[],TQCB:[],TQOB:[]},this.currentPortfolio=[]}}M.getStatic={getTableData:()=>E,getPortfolio:()=>$.portfolio};class O{constructor(e){this.headers=M.getStatic.getTableData().apply(null).columns.map((e=>e.title)),this.props=M.getStatic.getTableData().apply(null).columns.map((e=>e.cell)),this.footers=[],this.components=[],this.init(e)}init(e){e.forEach((e=>{if(e){const t=new d;Object.keys(e).forEach((n=>{const r=this.props.indexOf(n);if(r>-1){const i=e[n];this.initSortfield(e[n],i,r),t.props.push(i)}})),this.components.push(t)}})),this.initFooters(e)}initSortfield(e,t,n){t.sort=n,t.sortField=e.value}initFooters(e){this.footers=M.getStatic.getTableData().apply(null).columns.map((e=>e.footer))}calcBuy(e){let t=0;return e.forEach((e=>{t+=e.startPrice.value*e.count.value})),s(t.toFixed(2))}calcChange(e){let t=0,n=0,r=0;return e.forEach((e=>{t+=e.change.currentValue*e.count.value-e.change.startValue*e.count.value,r+=e.change.startValue*e.count.value})),n=t/r*100,`<span class="${t>0?"text-green-500":"text-red-500"}">\n      ${s(t.toFixed(2))} ₽\n      (${s(n.toFixed(2))} %)\n    </span>`}}async function R(e,t){let n="",r=t.join(",");r.length&&(r="?securities="+r),n="TQBR"===e?"https://iss.moex.com/iss/engines/stock/markets/shares/boards/".concat(e,"/securities.json").concat(r):"https://iss.moex.com/iss/engines/stock/markets/bonds/boards/".concat(e,"/securities.json").concat(r);const i=await fetch(n).then((e=>e.json())),o=i.marketdata.data,a=i.securities.data,d=[];o.forEach(((e,n)=>{t.indexOf(e[0])>-1&&d.push(n)}));let s=null;return s=function(e,t,n,r){const i=[];return n.forEach((n=>{i.push({name:t[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].nameIndex],ticker:e[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].tickerIndex],price:e[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_1]?e[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_1]:t[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_2],open:t[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].openPriceIndex],currency:t[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].openPriceIndex],nominal:t[n][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].nominalIndex]})})),i}(o,a,d,e),{items:s,moexSecurities:a,moexMarketData:o}}function D(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const o=n.filter((e=>e[0]===String(t.get("name"))))[0];let a=1;({TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}})[e].nominalIndex&&(a=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].nominalIndex]);const d=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].currencyIndex],s=Number(t.get("price")),c=Number(t.get("currencyValue"))?Number(t.get("currencyValue")):1;let l=String((new Date).valueOf());return i&&!t.get("isclone")&&(l=i),{ticker:String(t.get("name")),type:{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type,market:e,buyPrice:s,count:Number(t.get("count")),buyCurrency:c,currency:d,nominal:a,nkd:Number(t.get("nkd"))||0,positionId:l,portfolioId:String(r)}}var N=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class q extends g{constructor(e,t,n){super(e,t,n),this.state=t,this.onSubmit=n}static create(e,t,n,r){return N(this,void 0,void 0,(function*(){const r=new q(e,t,n);return yield r.initMarketData(),r}))}initMarketData(){return N(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){const e=this.$el.querySelector('[name="name"]');e.focus(),this.initFormListeners(),this.initTickerInput(e)}searchItem(e){return N(this,void 0,void 0,(function*(){let t=[];return t=this.state.getters.getMoexByName(e),t}))}showInfo(){if(this.currentTicker){document.querySelector('label[for="name"]').textContent=this.currentTicker;const e=this.currentItem.name;e.length&&(document.querySelector('label[for="name"]').textContent=e)}}initFormListeners(){this.$el.querySelectorAll('input[data-calc="totalprice"]').forEach((e=>{e.addEventListener("input",(e=>{this.currentTicker&&this.calc(this.currentTicker,!1)}))})),this.$el.querySelector('[name="category"]').addEventListener("change",(e=>N(this,void 0,void 0,(function*(){this.category=e.target.value,this.changeForm(!0),yield this.initMarketData(),this.changeFields(),this.changeForm(!1)}))))}onSelect(e,t,n,r){e.target instanceof HTMLElement&&e.target.dataset.ticker&&(t.value=e.target.dataset.ticker,this.isvalid=!0,this.currentTicker=e.target.dataset.ticker,this.currentItem=this.state.getters.getData_moex(this.currentTicker,this.category,["name","fullname","engname","price","startPrice","currency","nominal","nkd"]),this.calc(this.currentTicker,!0),this.calcCurrency(),this.showInfo(),n.classList.add("hidden"),n.removeEventListener("click",r))}initTickerInput(t){t.addEventListener("input",(t=>N(this,void 0,void 0,(function*(){const n=t.target,r=t.target.value,i=this.$el.querySelector('[data-dropdown="name"]');if(i.innerHTML="",r.length>2&&this.state.getters.getMoexSearch()){this.foundList=yield this.searchItem(r),i.classList.remove("hidden"),e('[data-dropdown="name"]','[name="name"]');let t="";if(this.foundList.length){n.classList.remove("!border-red-500"),this.foundList.forEach((e=>{t+=`\n              <span data-name="${e[2]}" data-ticker="${e[0]}" class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e[2]}</span>\n            `}));const e=document.createElement("div");e.innerHTML=t,i.appendChild(e);const r=e=>{this.onSelect(e,n,i,r)};i.addEventListener("click",r)}else n.classList.add("!border-red-500"),this.isvalid=!1}else this.isvalid=!1,this.foundList=[],i.classList.add("hidden")}))))}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>N(this,void 0,void 0,(function*(){e.preventDefault();const t=new FormData(this.$el.querySelector("form"));let n=null;this.isvalid&&(n=D(this.category,t,this.state.moexSearch.moexSecurities,this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,this.modaldata?this.modaldata.id:null),this.onSubmit(this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,n,Boolean(t.get("isclone")),this.category))}))))}initBrokers(){const e=o(this.state);let t="";return e.forEach(((e,n)=>{let r="";0===n&&(r+='selected="selected"'),t+=`<option value="${e.id}" ${r}>${e.text}</option>`})),t}renderMode(){return N(this,void 0,void 0,(function*(){let e="",t=null;return this.modaldata&&(this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=`\n    <div class="sm:col-span-2 mb-4"  data-mode=""  data-mode-create="">\n        <label for="portfolio" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Портфель</label>\n        <select id="portfolio" name="portfolio" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">\n          ${this.initBrokers()}\n        </select>\n    </div>\n    \n    <div class="sm:col-span-2 mb-4"  data-mode=""  data-mode-create="">\n      <label for="category" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>\n      <select id="category" name="category" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">\n        <option value="TQBR">Stocks</option>\n        <option value="TQCB">Corporative Bonds</option>\n        <option value="TQOB">Bonds</option>\n      </select>\n  </div>\n    `+I("name","text","Название","","","","Тикер, наименование","<div  class=\"z-10 bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 absolute hidden\" data-dropdown='name'></div>")+'\n  <div class="flex items-center mb-4" data-input="clone" data-mode=""  data-mode-create="" data-mode-edit="">\n      <input id="isclone" name="isclone" type="checkbox" value="isclone"\n          class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-500 dark:border-gray-600 " />\n\n      <label for="isclone" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 cursor-pointer">\n          Clone ?\n      </label>\n  </div>'+this.renderPrice()+this.renderCount()+this.renderNkd()+this.renderCurrency()+this.renderStop(),e+=this.renderSubmit(),e}))}renderSubmit(){return'\n      <div class="flex items-center">\n        <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n            Confirm\n        </button>\n        <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n      </div>\n    '}}var F=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};class A extends i{constructor(e,t){super(e,Object.assign({listeners:[]},t)),this.state=t.state,this.emitter=t.emitter,this.unsubs=[]}init(){const e=o(this.state);this.dropdownPortfolio=new n("#dropdownButton","Портфель","#dropdownMenu",[...e],this.changeBroker.bind(this)),document.querySelector('[data-click="changeTheme"]').addEventListener("click",(e=>{this.$emit("header:changeTheme")})),document.querySelector('[data-click="showAllBrokers"]').addEventListener("click",(e=>{this.$emit("table:showAllBrokers")})),document.querySelector('[data-click="showHistory"]').addEventListener("click",(e=>{this.$emit("table:changeView","appHistory")})),document.querySelector('[data-modal="newPosition"]').addEventListener("click",(e=>F(this,void 0,void 0,(function*(){const e=yield q.create("#modalContent",this.state,this.addPosition.bind(this));this.$emit("modal:renderModal",{title:"Add new position",content:e.$el.innerHTML}),yield e.initForm()})))),this.$on("header:changeTheme",(()=>{this.changeTheme()})),this.$on("header:moexUpdate",(e=>F(this,void 0,void 0,(function*(){this.state.moex=yield this.state.actions.initMoex(),this.$emit("table:changeBroker",e),this.dropdownPortfolio.setValue(this.state.getters.getPortfolioById(e).name)}))))}addPosition(e,t,n,r){this.state.actions.addPosition(e,t,n,r),this.$emit("header:moexUpdate",e),this.$emit("modal:closeModal")}toHTML(){return'\n    <div class="headerwrapper h-full w-64">\n    <div id="headerpanel" class=\'py-2 bg-slate-100 dark:bg-slate-600 mb-2 h-full\'>\n      <div class="flex flex-col justify-between px-8 h-full ">\n        <div class=\'block\'>\n          <div class="block mb-2" id=\'ddHeaderLeft\'>\n            <button id="dropdownButton" data-dropdown-toggle="dropdown" class="w-full justify-center text-white bg-slate-500 hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-slate-800 dark:hover:bg-slate-500 dark:focus:ring-slate-800  justify-center" type="button"> <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">\n              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>\n              </svg>\n              </button>\n              \n              \x3c!-- Dropdown menu --\x3e\n              <div id="dropdownMenu" class="z-10 hidden bg-white divide-y divide-slate-100 rounded-lg shadow w-44 dark:bg-slate-500">\n                 \n              </div>\n          </div>\x3c!-- /.block --\x3e\n          <div class="block mb-2 w-full ">\n            <button data-click="showAllBrokers" class="w-full justify-center text-white bg-slate-500 hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-slate-800 dark:hover:bg-slate-500 dark:focus:ring-slate-800" type="button">Все портфели</button>\n          </div>\x3c!-- /.block --\x3e\n          <div class="block mb-2 w-full  ">\n            <button data-modal="newPosition" class="w-full justify-center text-white bg-[#629976] 400 hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center  dark:focus:ring-slate-800" type="button">Добавить позицию</button>\n          </div>\x3c!-- /.block --\x3e\n            <div class="block mb-2 w-full ">\n            <button data-click="showHistory" class="w-full justify-center text-white bg-slate-500 hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-slate-800 dark:hover:bg-slate-500 dark:focus:ring-slate-800" type="button">Журнал сделок</button>\n          </div>\x3c!-- /.block --\x3e\n          \x3c!-- <div class="block mb-2  w-full ">\n            <button data-modal="sellPosition" class="w-full justify-center text-white bg-[#d07676] hover:bg-slate-800 focus:ring-4 focus:outline-none focus:ring-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-centerdark:focus:ring-slate-800" type="button">Продать</button>\n          </div> --\x3e\n        </div>\n        <div class="cursor-pointer group" data-click=\'changeTheme\' >\n          <svg width="30px" height="30px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  \n            <g  stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                <g class=\'fill-slate-400 group-hover:fill-slate-900 dark:fill-slate-300 dark:group-hover:fill-slate-100\' id="ic_fluent_dark_theme_24_regular" fill="#212121" fill-rule="nonzero">\n                  <path d="M12,22 C17.5228475,22 22,17.5228475 22,12 C22,6.4771525 17.5228475,2 12,2 C6.4771525,2 2,6.4771525 2,12 C2,17.5228475 6.4771525,22 12,22 Z M12,20.5 L12,3.5 C16.6944204,3.5 20.5,7.30557963 20.5,12 C20.5,16.6944204 16.6944204,20.5 12,20.5 Z" id="">\n                  </path>\n                </g>\n            </g>\n          </svg>\n        </div>\x3c!-- /.theme --\x3e\n      </div>\x3c!-- /.flex items-center --\x3e\n    </div>\x3c!-- /#headerpanel --\x3e\n    <div id="headercontent"></div>\x3c!-- /#headercontent --\x3e\n  </div>\n    '}changeTheme(){const e=document.querySelector("html");e instanceof Element&&t(e,"dark"),this.$emit("header:theme")}showAllBrokers(){this.$emit("header:allbrokers"),this.dropdownPortfolio.reset()}changeBroker(e){const t=+e.target.dataset.params;this.$emit("table:changeBroker",t)}}A.id="header";class j{constructor(e){this.$root=document.querySelector(e)}$(e){const t=document.querySelectorAll(e);if(t)return 1===t.length?t[0]:t}append(e){return e instanceof j&&(e=e.$root),this.$root.append(e),this}initListeners(e){this.$root.querySelectorAll(`[data-${e}]`).forEach((t=>{const n=this[t.dataset[e]].bind(this);this.onEvent(t,e,n)}))}onEvent(e,t,n){e.addEventListener(t,n)}offEvent(e,t){this.$root.removeEventListener(e,t)}on(e,t){this.$root.addEventListener(e,t)}off(e,t){this.$root.removeEventListener(e,t)}content(e){this.$root.innerHTML=e}toggleClass(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}toggleClassEl(e,t,n){const r=document.querySelector(t);r&&r.classList.remove(n),e&&e.classList.add(n)}}class V{constructor(){this.listeners={}}emit(e,...t){return!!Array.isArray(this.listeners[e])&&(this.listeners[e].forEach((e=>{e(...t)})),!0)}subscribe(e,t){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t),()=>{this.listeners[e]=this.listeners[e].filter((e=>e!=t))}}}class H{constructor(e,t){this.selector=e,this.options=t,this.state=t.state,this.$el=new j(e),this.components=t.components||[],this.emitter=new V}initApp(){const e=document.createElement("div"),t={emitter:this.emitter,state:this.state};return this.instances=this.components.map((n=>{const r=document.createElement("div"),i=new n(r,t);return r.setAttribute("id",n.id),r.innerHTML=i.toHTML(),e.append(r),i})),e}render(){this.$el.append(this.initApp()),this.instances.forEach((e=>e.init()))}}class U extends i{constructor(e,t){super(e,Object.assign({listeners:[]},t)),this.emitter=t.emitter,this.state=t.state,this.unsubs=[]}init(){document.querySelectorAll("[data-modal-toggle]").forEach((e=>{e.addEventListener("click",(()=>{this.$emit("modal:closeModal")}))})),this.$on("modal:renderModal",(e=>{document.querySelector("#modalWrapper").classList.remove("hidden"),document.querySelector("#modalContent").innerHTML=e.content,document.querySelector("#modalTitle").innerHTML=e.title})),this.$on("modal:closeModal",(()=>{document.querySelector("#modalWrapper").classList.add("hidden"),document.querySelector("#modalContent").innerHTML="",document.querySelector("#modalTitle").innerHTML=""})),e("#modalBlock","[data-modal]","#modalWrapper",(()=>{this.$emit("modal:closeModal")}))}toHTML(){return'\n      <div id="modalWrapper" tabindex="-1" aria-hidden="true" class="flex bg-[rgba(0,0,0,0.55)] overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 bottom-0 m-auto z-50 justify-center items-center w-full md:inset-0 h-modal md:h-full hidden">\n      <div id="modalBlock" class="relative p-4 w-full max-w-2xl h-full md:h-auto">\n          <div class="relative p-4 bg-white rounded-lg shadow dark:bg-gray-800 sm:p-5">\n              \x3c!-- Modal header --\x3e\n              <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-600">\n                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">\n                  <div id="modalTitle"></div>\n                  </h3>\n                  <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-toggle="updateProductModal">\n                      <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>\n                      <span class="sr-only">Close modal</span>\n                  </button>\n              </div>\n            <div id="modalContent" class="text-gray-900 dark:text-white"></div>\n        </div>\n      </div>\n  </div>\n  '}}U.id="modal";const z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function*(){let t=e;for(;;)yield++t}()}();function Z(e,t){const n=[];e.querySelector("tbody").innerHTML="",t.forEach((e=>{const t=function(e){let t='<tr class="border-b dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700">';e.sort(((e,t)=>e.sort-t.sort));let n=0;return e.forEach((e=>{t+=W(e.render(),n),n+=1})),t+="</tr>",t}(e.props);n.push(t)})),e.querySelector("tbody").insertAdjacentHTML("afterbegin",n.join(""))}function W(e,t,n=!1,r=!1){let i=`<td class=" py-2 relative cursor-pointer font-medium text-slate-900 whitespace-nowrap dark:text-white ${n?"pl-4 pr-4 hover:text-[#00aff5] dark:hover:text-[#00aff5]":" px-4"}" data-sort="${t}" ${n?'data-header="asc"':""}>`;return i+=e,i+="</td>",i}class J extends j{constructor(e,t,n,r,i){super(e),this.selector=e,this.Component=t,this.items=n,this.emitter=r,this.tablename=i,this.init()}init(){this.instances=new this.Component(this.items)}render(){const e=document.querySelector(this.selector);e.insertAdjacentHTML("afterend",'<div class="table"></div>'),e.classList.remove("table"),e.classList.add("renderedTable");const t=e.appendChild(document.createElement("div")),n=function(e,t=null,n){const r=function(e){let t='<tr class="border-b bg-slate-100 dark:bg-slate-700 dark:border-slate-600 hover:bg-slate-200 dark:hover:bg-slate-700">',n=0;return e.forEach((e=>{t+=W(e,n,!0),n+=1})),t+="</tr>",t}(e);let i=null;return t&&(i=function(e){let t='<tr class="border-b dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700">',n=0;return e.forEach((e=>{t+=W(e,n,!1,!0),n+=1})),t+="</tr>",t}(t)),` \n    <section class="w-full dark:bg-slate-800 py-3 sm:py-5" id=table${z.next().value}>\n      <div class="w-full mx-auto px-8">\n      <h2 class="text-2xl font-bold mb-4 dark:text-white">${n||""}</h2>\n        <div class="w-full relative bg-white dark:bg-slate-800">\n        <table class="w-full">\n        <thead>${null!=r?r:""}</thead>\n        <tbody></tbody>\n        <tfoot>${null!=i?i:""}</tfoot>\n        </table>\n        </div>\n      </div>\n    </section>\n  `}(this.instances.headers,this.instances.footers,this.tablename);t.innerHTML=n,Z(e,this.instances.components),t.addEventListener("click",(t=>{this.sortTable(e,t)})),this.instances.components.forEach((e=>{e.props.forEach((e=>{e&&e.initListeners(this.emitter)}))}))}sortTable(e,t){if(t.target instanceof HTMLElement){const n=t.target.getAttribute("data-header"),r=t.target.classList;n&&("asc"===n&&(this.sortAsc(Number(t.target.getAttribute("data-sort"))),t.target.setAttribute("data-header","desc"),r.remove("asc"),r.remove("desc"),r.add("desc")),"desc"===n&&(this.sortDesc(Number(t.target.getAttribute("data-sort"))),t.target.setAttribute("data-header","asc"),r.remove("asc"),r.remove("desc"),r.add("asc")),this.toggleClassEl(t.target,".sorted","sorted"),Z(e,this.instances.components))}}sortAsc(e){this.instances.components.sort(((t,n)=>t.props[e].sortField-n.props[e].sortField))}sortDesc(e){this.instances.components.sort(((t,n)=>n.props[e].sortField-t.props[e].sortField))}}class K extends j{constructor(e){super(e),this.selector=e}createTable(){}render(){document.querySelector(this.selector).insertAdjacentHTML("beforeend",'<div class="history"></div>')}}class G extends i{constructor(e,t){super(e,Object.assign({listeners:[]},t))}init(){this.initStartstate(),this.$on("table:changeBroker",(e=>{this.changeTableId(e)})),this.$on("table:showAllBrokers",(()=>{this.changeTableId()})),this.$on("table:changeView",(e=>{"appHistory"===e&&(this.removeTables(),new K("#tableblock").render())}))}initStartstate(){const e=this.state.getters.getAllPortfolio();this.createTable(e)}toHTML(){return'\n      <div class="table"></div>\n    '}createTable(e,t="createPositions",n="TablePosition"){this.state.actions.getAction(t).call(this,e,this.state).forEach((e=>{M.currentDataID=this.state.getters.getPortfolioId(e.name),new J(".table",{TablePosition:O}[n],e.positions,this.emitter,e.name).render()}))}removeTables(){M.portfolioName=null,this.state.actions.changeBroker(null),document.querySelectorAll(".renderedTable").forEach((e=>{e.remove()}))}changeTableId(e){if(this.removeTables(),e)this.state.actions.changeBroker(String(e)),this.createTable(this.state.currentPortfolio);else{const e=this.state.getters.getAllPortfolio();this.createTable(e)}}}G.id="tableblock";const Y=new M;!function(){var e,t,n,r;e=this,t=void 0,r=function*(){Y.moex=yield Y.actions.initMoex(),localStorage.setItem("moexdata",JSON.stringify(Y.moex)),Y.currency=yield Y.actions.initCurrency(),new H("#app",{components:[A,G,U],state:Y}).render()},new((n=void 0)||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function d(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))}()})();