(()=>{"use strict";function e(e,n,t,r){const i=document.querySelector(n),o=document.querySelector(e);function d(){i&&o&&(i.classList.remove("active"),t?document.querySelector(t).classList.add("hidden"):o.classList.add("hidden"),r instanceof Function&&r())}document.addEventListener("click",(function(t){t.target.closest("".concat(e,",").concat(n))||d()})),document.addEventListener("keyup",(function(e){"Escape"===e.key&&d()}))}function n(e,n){e.classList.contains(n)?e.classList.remove(n):e.classList.add(n)}class t{constructor(e,n,t,r,i,o={width:"300px",placement:"bottom",delay:200,ignoreClickOutsideClass:!1,position:"absolute"}){this.trigger=e,this.triggerText=n,this.target=t,this.items=r,this.options=o,this.$targetEl=document.querySelector(t),this.$triggerEl=document.querySelector(e),this.triggerText=n,this.callback=i,this.initDropdown()}initDropdown(){this.$targetEl.classList.add(this.options.position),this.$triggerEl.firstChild.textContent=this.triggerText;let t="";this.items.forEach((e=>{"link"===e.type?t+=`\n        <li>\n          <a href="${e.id}" data-value="${e.text}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e.text}</a>\n        </li>\n      `:t+=`\n        <li>\n          <span  data-params="${e.id}" data-value="${e.text}" class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e.text}</span>\n        </li>\n      `})),this.$targetEl.innerHTML=`\n      <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownButton">\n        ${t}\n      </ul>\n    `,this.$triggerEl.addEventListener("click",(e=>{n(this.$triggerEl,"active"),n(this.$targetEl,"hidden")})),this.changeText(),e(this.target,this.trigger)}setValue(e){this.$triggerEl.firstChild.textContent=e}changeText(){this.$targetEl.addEventListener("click",(e=>{e.target instanceof HTMLElement&&e.target.dataset.value&&(this.$triggerEl.firstChild.textContent=e.target.dataset.value,this.callback&&this.callback(e))}))}reset(){this.$triggerEl.firstChild.textContent=this.triggerText}}class r{constructor(e,n){if(this.$root=e,this.listeners=n,!e)throw new Error("No $root provided for DomListenter")}initDOMListeners(){this.listeners.forEach((e=>{const n=e;if(!this[n]){const e=this.name||"";throw new Error(`Method ${n} is not implemented in ${e} Component`)}this[n]=this[n].bind(this),this.$root.on(e,this[n])}))}removeDOMListeners(){this.listeners.forEach((e=>{const n=e;this.$root.off(e,this[n])}))}}class i extends r{constructor(e,n){super(e,n.listeners),this.emitter=n.emitter,this.state=n.state,this.unsubs=[],this.prepare()}prepare(){}toHTML(){return""}init(){this.initDOMListeners()}$emit(e,...n){this.emitter.emit(e,...n)}$on(e,n){const t=this.emitter.subscribe(e,n);this.unsubs.push(t)}destroy(){this.removeDOMListeners(),this.unsubs.forEach((e=>e()))}}function o(e){const n=e.getters.getAllPortfolio(),t=[];return n.forEach((e=>{t.push({id:String(e.id),text:e.name,type:"event"})})),t}async function d(e,n){let t="",r=n.join(",");r.length&&(r="?securities="+r),t="TQBR"===e?"https://iss.moex.com/iss/engines/stock/markets/shares/boards/".concat(e,"/securities.json").concat(r):"https://iss.moex.com/iss/engines/stock/markets/bonds/boards/".concat(e,"/securities.json").concat(r);const i=await fetch(t).then((e=>e.json())),o=i.marketdata.data,d=i.securities.data,a=[];o.forEach(((e,t)=>{n.indexOf(e[0])>-1&&a.push(t)}));let s=null;return s=function(e,n,t,r){const i=[];return t.forEach((t=>{i.push({name:n[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].nameIndex],ticker:e[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].tickerIndex],price:e[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_1]?e[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_1]:n[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].priceIndex_2],open:n[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].openPriceIndex],currency:n[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].openPriceIndex],nominal:n[t][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[r].nominalIndex]})})),i}(o,d,a,e),{items:s,moexSecurities:d,moexMarketData:o}}function a(e,n,t,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const o=t.filter((e=>e[0]===String(n.get("name"))))[0];let d=1;({TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}})[e].nominalIndex&&(d=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].nominalIndex]);const a=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].currencyIndex],s=Number(n.get("price")),c=Number(n.get("currencyValue"))?Number(n.get("currencyValue")):1;let l=String((new Date).valueOf());return i&&!n.get("isclone")&&(l=i),{ticker:String(n.get("name")),type:{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type,market:e,buyPrice:s,count:Number(n.get("count")),buyCurrency:c,currency:a,nominal:d,nkd:Number(n.get("nkd"))||0,positionId:l,portfolioId:String(r)}}function s(e){if(e){const n=e.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),n.join(".")}return 0===e?"0":""}function c(e,n,t,r,i,o,d,a,s){return`\n    <div class="w-full  mb-4 ${s}" ${i}>\n        <label for="${e}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">${t}</label>\n        <input ${o} step="0.000000001" value="${r}"  type="${n}" name="${e}" id="${e}" autocomplete="off" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="${d}" >\n        ${a||""}\n    </div>\n  `}var l=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class u{constructor(e,n,t,r){this.state=n,this.onSubmit=t,this.modaldata=r,this.$el=document.querySelector(e),this.isvalid=!1,this.category=this.state.getters.getCategory(this.state.defaultPortfolio)}initMarketData(){return l(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initForm(){return l(this,void 0,void 0,(function*(){const e=document.createElement("form");e.setAttribute("id","createForm"),this.$el.insertAdjacentElement("beforeend",e);const n=yield this.renderMode();e.insertAdjacentHTML("afterbegin",function(e){return`\n        <div id="modalLoader" class="hidden loader absolute w-full h-full flex items-center justify-center left-0 right-0 top-0 bottom-0 z-40 bg-[rgba(233,233,233,0.2)]">\n          <div role="status">\n              <svg aria-hidden="true" class="w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>\n                  <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>\n              </svg>\n              <span class="sr-only">Loading...</span>\n          </div>\n        </div>\n      ${e}\n     </div>\n  `}(n)),this.postInit(),this.changeFields(),this.initFormSubmit()}))}changeForm(e){const n=document.querySelector(".loader");e?n.classList.remove("hidden"):n.classList.add("hidden")}addVisible(e){const n=document.querySelector(e);n&&n.classList.remove("hidden")}removeVisible(e){const n=document.querySelector(e);n&&n.classList.add("hidden")}changeFields(){"bonds"==={TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[this.category].type?(this.removeVisible('[data-input="stopValue"]'),this.addVisible('[data-input="nkd"]'),this.addVisible('[data-input="stopValue"]')):(this.addVisible('[data-input="stopValue"]'),this.removeVisible('[data-input="nkd"]'),this.removeVisible('[data-input="stopValue"]'))}calcCurrency(){const e=document.querySelector('[data-input="currencyValue"]'),n=e.querySelector("input"),t=this.currentItem.currency;t&&"SUR"!==t?(e.classList.remove("hidden"),n.value=String(this.state.getters.getCurrency(t))):(e.classList.add("hidden"),n.value="1")}calc(e,n){let t=0,r=0,i=0;const o=document.querySelector('input[name="price"]'),d=document.querySelector('input[name="stop"]'),a=document.querySelector('input[name="count"]'),c=document.querySelector('[data-result="total"]'),l=document.querySelector('input[name="nkd"]'),u=document.querySelector("#portfolio").value;if(this.currentPortfolio=u,""===e)return o.value="",d.value="",a.value="",void(c.textContent="0");if(n){const e=this.currentItem.nominal,n=this.state.getters.getCurrency(this.currentItem.currency),i=this.currentItem.price*Number(n)*(e>1?Number(e)/100:1);t=.98*Number(this.currentItem.price),r=Math.round(this.state.getters.getPortfolioSumm(u)/Number(i)),c.textContent=s(String((i*r).toFixed(2)))}else Number(o.value),t=Number(d.value),r=Number(a.value);o.value=String(this.currentItem.price),a.value=String(r),d.value=String(t.toFixed(2)),l.value=String(this.currentItem.nkd)}initFormListeners(){this.$el.querySelectorAll('input[data-calc="totalprice"]').forEach((e=>{e.addEventListener("input",(e=>{this.currentTicker&&this.calc(this.currentTicker,!1)}))})),this.$el.querySelector('[name="category"]').addEventListener("change",(e=>l(this,void 0,void 0,(function*(){this.category=e.target.value,this.changeForm(!0),yield this.initMarketData(),this.changeFields(),this.changeForm(!1)}))))}initFormSubmit(){}renderMode(){return l(this,void 0,void 0,(function*(){return""}))}renderName(e){return c("name","text","Наименование",e||"","","readonly","Наименование")}renderPrice(e){return c("price","number","Цена покупки",e||"0","",'data-calc="totalprice"',"Цена")}renderNkd(e){return c("nkd","number","НКД",e||"0",'data-input="nkd"','data-calc="totalprice"',"НКД","","hidden")}renderCount(e){return c("count","number","Количество",e||"1",'data-input="count"','data-calc="totalprice"',"Количество")}renderStop(e){return c("stop","number","Стоп-лосс",e||"0",'data-input="stopValue"','data-calc=""',"Стоп-лосс")}renderCurrency(e){return c("currencyValue","number","Валюта в момент сделки",e||"1",'data-input="currencyValue"','data-calc="totalprice"',"Курс валюты","","hidden")}renderDescription(e){return`\n    <div class="sm:col-span-2 mb-4"${e||""}>\n        <label for="${n="description"}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Комментарии</label>\n        <textarea id="${n}" undefined  rows="4" class="block p-1 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Примечание">undefined</textarea>\n    </div>\n  `;var n}renderSalePrice(e){return c("salePrice","number","Цена продажи",e||"0","",'data-calc="totalprice"',"Цена")}renderSaleNkd(e){return c("saleNkd","number","НКД",e||"0",'data-input="nkd"','data-calc="totalprice"',"НКД","","hidden")}renderSaleCount(e){return c("saleCount","number","Количество",e||"1",'data-input="count"','data-calc="totalprice"',"Количество")}renderSaleCurrency(e){return c("saleCurrency","number","Валюта в момент сделки",e||"1",'data-input="currencyValue"','data-calc="totalprice"',"Курс валюты","","hidden")}}var m=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class x extends u{constructor(e,n,t){super(e,n,t),this.state=n,this.onSubmit=t}static create(e,n,t,r){return m(this,void 0,void 0,(function*(){const r=new x(e,n,t);return yield r.initMarketData(),r}))}initMarketData(){return m(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){const e=this.$el.querySelector('[name="name"]');e.focus(),this.initFormListeners(),this.initTickerInput(e)}searchItem(e){return m(this,void 0,void 0,(function*(){let n=[];return n=this.state.getters.getMoexByName(e),n}))}showInfo(){if(this.currentTicker){document.querySelector('label[for="name"]').textContent=this.currentTicker;const e=this.currentItem.name;e.length&&(document.querySelector('label[for="name"]').textContent=e)}}initFormListeners(){this.$el.querySelectorAll('input[data-calc="totalprice"]').forEach((e=>{e.addEventListener("input",(e=>{this.currentTicker&&this.calc(this.currentTicker,!1)}))})),this.$el.querySelector('[name="category"]').addEventListener("change",(e=>m(this,void 0,void 0,(function*(){this.category=e.target.value,this.changeForm(!0),yield this.initMarketData(),this.changeFields(),this.changeForm(!1)}))))}onSelect(e,n,t,r){e.target instanceof HTMLElement&&e.target.dataset.ticker&&(n.value=e.target.dataset.ticker,this.isvalid=!0,this.currentTicker=e.target.dataset.ticker,this.currentItem=this.state.getters.getData_moex(this.currentTicker,this.category,["name","fullname","engname","price","startPrice","currency","nominal","nkd"]),this.calc(this.currentTicker,!0),this.calcCurrency(),this.showInfo(),t.classList.add("hidden"),t.removeEventListener("click",r))}initTickerInput(n){n.addEventListener("input",(n=>m(this,void 0,void 0,(function*(){const t=n.target,r=n.target.value,i=this.$el.querySelector('[data-dropdown="name"]');if(i.innerHTML="",r.length>2&&this.state.getters.getMoexSearch()){this.foundList=yield this.searchItem(r),i.classList.remove("hidden"),e('[data-dropdown="name"]','[name="name"]');let n="";if(this.foundList.length){t.classList.remove("!border-red-500"),this.foundList.forEach((e=>{n+=`\n              <span data-name="${e[2]}" data-ticker="${e[0]}" class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">${e[2]}</span>\n            `}));const e=document.createElement("div");e.innerHTML=n,i.appendChild(e);const r=e=>{this.onSelect(e,t,i,r)};i.addEventListener("click",r)}else t.classList.add("!border-red-500"),this.isvalid=!1}else this.isvalid=!1,this.foundList=[],i.classList.add("hidden")}))))}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>m(this,void 0,void 0,(function*(){e.preventDefault();const n=new FormData(this.$el.querySelector("form"));let t=null;this.isvalid&&(t=a(this.category,n,this.state.moexSearch.moexSecurities,this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,this.modaldata?this.modaldata.id:null),this.onSubmit(this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,t,Boolean(n.get("isclone")),this.category))}))))}initBrokers(){const e=o(this.state);let n="";return e.forEach(((e,t)=>{let r="";0===t&&(r+='selected="selected"'),n+=`<option value="${e.id}" ${r}>${e.text}</option>`})),n}renderMode(){return m(this,void 0,void 0,(function*(){let e="",n=null;return this.modaldata&&(this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=`\n    <div class="sm:col-span-2 mb-4"  data-mode=""  data-mode-create="">\n        <label for="portfolio" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Портфель</label>\n        <select id="portfolio" name="portfolio" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">\n          ${this.initBrokers()}\n        </select>\n    </div>\n    \n    <div class="sm:col-span-2 mb-4"  data-mode=""  data-mode-create="">\n      <label for="category" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>\n      <select id="category" name="category" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">\n        <option value="TQBR">Stocks</option>\n        <option value="TQCB">Corporative Bonds</option>\n        <option value="TQOB">Bonds</option>\n      </select>\n  </div>\n    `+c("name","text","Название","","","","Тикер, наименование","<div  class=\"z-10 bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 absolute hidden\" data-dropdown='name'></div>")+'\n  <div class="flex items-center mb-4" data-input="clone" data-mode=""  data-mode-create="" data-mode-edit="">\n      <input id="isclone" name="isclone" type="checkbox" value="isclone"\n          class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-500 dark:border-gray-600 " />\n\n      <label for="isclone" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 cursor-pointer">\n          Clone ?\n      </label>\n  </div>'+this.renderPrice()+this.renderCount()+this.renderNkd()+this.renderCurrency()+this.renderStop(),e+=this.renderSubmit(),e}))}renderSubmit(){return'\n      <div class="flex items-center">\n        <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n            Confirm\n        </button>\n        <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n      </div>\n    '}}var h=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class p extends i{constructor(e,n){super(e,Object.assign({listeners:[]},n)),this.state=n.state,this.emitter=n.emitter,this.unsubs=[]}init(){const e=o(this.state);this.dropdownPortfolio=new t("#dropdownButton","Портфель","#dropdownMenu",[...e],this.changeBroker.bind(this)),document.querySelector('[data-click="changeTheme"]').addEventListener("click",(e=>{this.$emit("header:changeTheme")})),document.querySelector('[data-click="showAllBrokers"]').addEventListener("click",(e=>{this.$emit("table:showAllBrokers")})),document.querySelector('[data-modal="newPosition"]').addEventListener("click",(e=>h(this,void 0,void 0,(function*(){const e=yield x.create("#modalContent",this.state,this.addPosition.bind(this));this.$emit("modal:renderModal",{title:"Add new position",content:e.$el.innerHTML}),yield e.initForm()})))),document.querySelector('[data-modal="sellPosition"]').addEventListener("click",(e=>{this.$emit("modal:renderModal",{title:"Sell position",content:"FORM"})})),this.$on("header:changeTheme",(()=>{this.changeTheme()})),this.$on("header:moexUpdate",(e=>h(this,void 0,void 0,(function*(){this.state.moex=yield this.state.actions.initMoex(),this.$emit("table:changeBroker",e),this.dropdownPortfolio.setValue(this.state.getters.getPortfolioById(e).name)}))))}addPosition(e,n,t,r){this.state.actions.addPosition(e,n,t,r),this.$emit("header:moexUpdate",e),this.$emit("modal:closeModal")}toHTML(){return'\n    <div class="headerwrapper">\n    <div id="headerpanel" class=\'py-2 bg-slate-100 dark:bg-gray-600 mb-8\'>\n      <div class="flex items-center justify-between container">\n        <div class=\'flex items-center\'>\n          <div class="block" id=\'ddHeaderLeft\'>\n            <button id="dropdownButton" data-dropdown-toggle="dropdown" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800  justify-center" type="button"> <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">\n              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>\n              </svg>\n              </button>\n              \n              \x3c!-- Dropdown menu --\x3e\n              <div id="dropdownMenu" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">\n                 \n              </div>\n          </div>\x3c!-- /.block --\x3e\n          <div class="block ml-8  ">\n            <button data-click="showAllBrokers" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">Все портфели</button>\n          </div>\x3c!-- /.block --\x3e\n          <div class="block ml-8  ">\n            <button data-modal="newPosition" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">Добавить позицию</button>\n          </div>\x3c!-- /.block --\x3e\n          <div class="block ml-8  ">\n            <button data-modal="sellPosition" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">Убрать позицию</button>\n          </div>\x3c!-- /.block --\x3e\n        </div>\n        <div class="cursor-pointer group" data-click=\'changeTheme\' >\n          <svg width="30px" height="30px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  \n            <g  stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                <g class=\'fill-gray-400 group-hover:fill-gray-900 dark:fill-slate-300 dark:group-hover:fill-slate-100\' id="ic_fluent_dark_theme_24_regular" fill="#212121" fill-rule="nonzero">\n                  <path d="M12,22 C17.5228475,22 22,17.5228475 22,12 C22,6.4771525 17.5228475,2 12,2 C6.4771525,2 2,6.4771525 2,12 C2,17.5228475 6.4771525,22 12,22 Z M12,20.5 L12,3.5 C16.6944204,3.5 20.5,7.30557963 20.5,12 C20.5,16.6944204 16.6944204,20.5 12,20.5 Z" id="">\n                  </path>\n                </g>\n            </g>\n          </svg>\n        </div>\x3c!-- /.theme --\x3e\n      </div>\x3c!-- /.flex items-center --\x3e\n    </div>\x3c!-- /#headerpanel --\x3e\n    <div id="headercontent"></div>\x3c!-- /#headercontent --\x3e\n  </div>\n    '}changeTheme(){const e=document.querySelector("html");e instanceof Element&&n(e,"dark"),this.$emit("header:theme")}showAllBrokers(){this.$emit("header:allbrokers"),this.dropdownPortfolio.reset()}changeBroker(e){const n=+e.target.dataset.params;this.$emit("table:changeBroker",n)}}p.id="header";class I{constructor(e){this.$root=document.querySelector(e)}$(e){const n=document.querySelectorAll(e);if(n)return 1===n.length?n[0]:n}append(e){return e instanceof I&&(e=e.$root),this.$root.append(e),this}initListeners(e){this.$root.querySelectorAll(`[data-${e}]`).forEach((n=>{const t=this[n.dataset[e]].bind(this);this.onEvent(n,e,t)}))}onEvent(e,n,t){e.addEventListener(n,t)}offEvent(e,n){this.$root.removeEventListener(e,n)}on(e,n){this.$root.addEventListener(e,n)}off(e,n){this.$root.removeEventListener(e,n)}content(e){this.$root.innerHTML=e}toggleClass(e,n){e.classList.contains(n)?e.classList.remove(n):e.classList.add(n)}toggleClassEl(e,n,t){const r=document.querySelector(n);r&&r.classList.remove(t),e&&e.classList.add(t)}}class g{constructor(){this.listeners={}}emit(e,...n){return!!Array.isArray(this.listeners[e])&&(this.listeners[e].forEach((e=>{e(...n)})),!0)}subscribe(e,n){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(n),()=>{this.listeners[e]=this.listeners[e].filter((e=>e!=n))}}}class f{constructor(e,n){this.selector=e,this.options=n,this.state=n.state,this.$el=new I(e),this.components=n.components||[],this.emitter=new g}initApp(){const e=document.createElement("div"),n={emitter:this.emitter,state:this.state};return this.instances=this.components.map((t=>{const r=document.createElement("div"),i=new t(r,n);return r.setAttribute("id",t.id),r.innerHTML=i.toHTML(),e.append(r),i})),e}render(){this.$el.append(this.initApp()),this.instances.forEach((e=>e.init()))}}class y extends i{constructor(e,n){super(e,Object.assign({listeners:[]},n)),this.emitter=n.emitter,this.state=n.state,this.unsubs=[]}init(){document.querySelectorAll("[data-modal-toggle]").forEach((e=>{e.addEventListener("click",(()=>{this.$emit("modal:closeModal")}))})),this.$on("modal:renderModal",(e=>{document.querySelector("#modalWrapper").classList.remove("hidden"),document.querySelector("#modalContent").innerHTML=e.content,document.querySelector("#modalTitle").innerHTML=e.title})),this.$on("modal:closeModal",(()=>{document.querySelector("#modalWrapper").classList.add("hidden"),document.querySelector("#modalContent").innerHTML="",document.querySelector("#modalTitle").innerHTML=""})),e("#modalBlock","[data-modal]","#modalWrapper",(()=>{this.$emit("modal:closeModal")}))}toHTML(){return'\n      <div id="modalWrapper" tabindex="-1" aria-hidden="true" class="flex bg-[rgba(0,0,0,0.55)] overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 bottom-0 m-auto z-50 justify-center items-center w-full md:inset-0 h-modal md:h-full hidden">\n      <div id="modalBlock" class="relative p-4 w-full max-w-2xl h-full md:h-auto">\n          <div class="relative p-4 bg-white rounded-lg shadow dark:bg-gray-800 sm:p-5">\n              \x3c!-- Modal header --\x3e\n              <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-600">\n                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">\n                  <div id="modalTitle"></div>\n                  </h3>\n                  <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-toggle="updateProductModal">\n                      <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>\n                      <span class="sr-only">Close modal</span>\n                  </button>\n              </div>\n            <div id="modalContent" class="text-gray-900 dark:text-white"></div>\n        </div>\n      </div>\n  </div>\n  '}}y.id="modal";class k{constructor(e){this.options=e}render(){return""}initListeners(e){}}var b=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class v extends u{constructor(e,n,t,r){super(e,n,t,r),this.state=n,this.onSubmit=t,this.modaldata=r}static create(e,n,t,r){return b(this,void 0,void 0,(function*(){const i=new v(e,n,t,r);return yield i.initMarketData(),i}))}initMarketData(){return b(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>b(this,void 0,void 0,(function*(){e.preventDefault();const n=new FormData(this.$el.querySelector("form"));let t=null;t=a(this.category,n,this.state.moexSearch.moexSecurities,this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,this.modaldata?this.modaldata.id:null),this.onSubmit(this.currentPortfolio?this.currentPortfolio:this.modaldata.ptf,t,Boolean(n.get("isclone")),this.category)}))))}renderMode(){return b(this,void 0,void 0,(function*(){let e="",n=null;return this.modaldata&&(n=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(n.ticker)+'\n  <div class="flex items-center mb-4" data-input="clone" data-mode=""  data-mode-create="" data-mode-edit="">\n      <input id="isclone" name="isclone" type="checkbox" value="isclone"\n          class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-500 dark:border-gray-600 " />\n\n      <label for="isclone" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 cursor-pointer">\n          Clone ?\n      </label>\n  </div>'+this.renderPrice(n.buyPrice)+this.renderCount(n.count)+this.renderNkd(n.nkd)+this.renderCurrency(n.buyCurrency)+this.renderStop(n.myStop),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var T=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class B extends u{constructor(e,n,t,r){super(e,n,t,r),this.state=n,this.onSubmit=t,this.modaldata=r}static create(e,n,t,r){return T(this,void 0,void 0,(function*(){const i=new B(e,n,t,r);return yield i.initMarketData(),i}))}initMarketData(){return T(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>T(this,void 0,void 0,(function*(){e.preventDefault();const n=new FormData(this.$el.querySelector("form"));let t=null;t=a(this.category,n,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,t)}))))}renderMode(){return T(this,void 0,void 0,(function*(){let e="",n=null;return this.modaldata&&(n=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(n.ticker)+this.renderPrice(n.buyPrice)+this.renderCount(n.count)+this.renderNkd(n.nkd)+this.renderCurrency(n.buyCurrency)+this.renderStop(n.myStop),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var w=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class P extends u{constructor(e,n,t,r){super(e,n,t,r),this.state=n,this.onSubmit=t,this.modaldata=r}static create(e,n,t,r){return w(this,void 0,void 0,(function*(){const i=new P(e,n,t,r);return yield i.initMarketData(),i}))}initMarketData(){return w(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>w(this,void 0,void 0,(function*(){e.preventDefault();const n=new FormData(this.$el.querySelector("form"));let t=null;t=a(this.category,n,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,t)}))))}renderMode(){return w(this,void 0,void 0,(function*(){let e="",n=null;return this.modaldata&&(n=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(n.ticker),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var _=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class C extends u{constructor(e,n,t,r){super(e,n,t,r),this.state=n,this.onSubmit=t,this.modaldata=r}static create(e,n,t,r){return _(this,void 0,void 0,(function*(){const i=new C(e,n,t,r);return yield i.initMarketData(),i}))}initMarketData(){return _(this,void 0,void 0,(function*(){yield this.state.actions.initSearch(this.category)}))}postInit(){}initFormSubmit(){this.$el.querySelector("form").addEventListener("submit",(e=>_(this,void 0,void 0,(function*(){e.preventDefault();const n=new FormData(this.$el.querySelector("form"));let t=null;t=function(e,n,t,r,i){const o=t.filter((e=>e[0]===String(n.get("name"))))[0];let d=1;({TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}})[e].nominalIndex&&(d=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].nominalIndex]);const a=o[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].currencyIndex],s=Number(n.get("price")),c=Number(n.get("currencyValue"))?Number(n.get("currencyValue")):1;return{ticker:String(n.get("name")),type:{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type,market:e,buyPrice:s,count:Number(n.get("count")),buyCurrency:c,currency:a,nominal:d,nkd:Number(n.get("nkd"))||0,positionId:i,portfolioId:String(r),saleCount:Number(n.get("saleCount")),salePrice:Number(n.get("salePrice")),saleCurrency:Number(n.get("saleCurrency")),saleNkd:Number(n.get("saleNkd"))}}(this.category,n,this.state.moexSearch.moexSecurities,this.modaldata.ptf,this.modaldata.id),this.onSubmit(this.modaldata.ptf,t,Boolean(n.get("isclone")),this.category)}))))}renderMode(){return _(this,void 0,void 0,(function*(){let e="",n=null;return this.modaldata&&(n=this.state.getters.getPositionById(this.modaldata.id),this.category=this.modaldata.market?this.modaldata.market:this.category,yield this.initMarketData()),e+=this.renderName(n.ticker)+this.renderSalePrice(n.buyPrice)+this.renderSaleCount(n.count)+this.renderSaleNkd(n.nkd)+this.renderSaleCurrency(n.buyCurrency),e+='\n    <div class="flex items-center">\n      <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">\n          Confirm\n      </button>\n      <div class="pl-4" data-result="total">0 </div>&nbsp;₽\n    </div>\n  ',e}))}}var Q=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class S extends k{constructor(e,n){super(n),this.itemInfo=e}initListeners(n){this.emitter=n;const t={id:this.itemInfo.positionId,ptf:this.itemInfo.portfolioId,market:this.itemInfo.marketId},r=document.querySelector(`#button_position${this.itemInfo.positionId}`),i=document.querySelector(`#menu_position${this.itemInfo.positionId}`);r.addEventListener("click",(e=>{i.classList.remove("hidden")})),document.querySelector(`[data-buypos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>Q(this,void 0,void 0,(function*(){const e=yield v.create("#modalContent",this.options,this.onBuy.bind(this),t);n.emit("modal:renderModal",{title:"Buy position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-editpos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>Q(this,void 0,void 0,(function*(){const e=yield B.create("#modalContent",this.options,this.onEdit.bind(this),t);n.emit("modal:renderModal",{title:"Edit position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-deletepos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>Q(this,void 0,void 0,(function*(){const e=yield P.create("#modalContent",this.options,this.onDelete.bind(this),t);n.emit("modal:renderModal",{title:"Delete position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),document.querySelector(`[data-salepos="${this.itemInfo.positionId}"]`).addEventListener("click",(e=>Q(this,void 0,void 0,(function*(){const e=yield C.create("#modalContent",this.options,this.onSale.bind(this),t);n.emit("modal:renderModal",{title:"Sale position",content:e.$el.innerHTML}),yield e.initForm(),i.classList.add("hidden")})))),e(`#menu_position${this.itemInfo.positionId}`,`#button_position${this.itemInfo.positionId}`)}onBuy(e,n,t,r){this.options.actions.addPosition(e,n,t,r),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onEdit(e,n){this.options.actions.editPosition(this.itemInfo.portfolioId,n),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onDelete(e,n){this.options.actions.deletePosition(this.itemInfo.portfolioId,n),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}onSale(e,n){this.options.actions.salePosition(this.itemInfo.portfolioId,n),this.emitter.emit("header:moexUpdate",this.itemInfo.portfolioId),this.emitter.emit("modal:closeModal")}render(){return`\n      <div class="flex relative">\n        <button id="button_position${this.itemInfo.positionId}" data-dropdown-toggle="dropdown" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-1 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 w-10 justify-center" type="button"> \n          <svg class="w-2.5 h-2.5 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">\n          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>\n          </svg>\n      </button>\n      \n      <div id="menu_position${this.itemInfo.positionId}" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 absolute top-full right-0">\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-buypos="${this.itemInfo.positionId}" >Купить</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-salepos="${this.itemInfo.positionId}">Продать</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-editpos="${this.itemInfo.positionId}">Изменить</div>\n        <div class='class="cursor-pointer block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"' data-deletepos="${this.itemInfo.positionId}">Удалить</div>\n      </div>\n    </div>\n    `}}var $=function(e,n,t,r){return new(t||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))};class L{constructor(){this.mutations={changeBroker:e=>{this.currentPortfolio=[],this.currentPortfolio.push(this.getters.getPortfolioById(e))},addPosition:(e,n,t,r)=>{const i=this.portfolio.filter((n=>n.id===e))[0],o=i.markets[r].filter((e=>e.positionId===n.positionId));if(t||!o.length)i.markets[r].push(n);else{const e=o[0];e.buyPrice=(n.buyPrice*n.count+e.buyPrice*e.count)/(n.count+e.count),e.count+=n.count}},editPosition:(e,n)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((t=>{t.markets[e].forEach((e=>{e.positionId===n.positionId&&(e.buyPrice=n.buyPrice,e.count=n.count,e.myStop=n.myStop,e.buyCurrency=n.buyCurrency,e.nkd=n.nkd)}))}))}))},salePosition:(e,n)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((t=>{t.markets[e].forEach((e=>{e.positionId===n.positionId&&(e.saleCount=n.saleCount,e.salePrice=n.salePrice,e.saleCurrency=n.saleCurrency,e.saleNkd=n.saleNkd,e.count-=n.saleCount,0===e.count&&(e.isSold=!0))}))}))}))},deletePosition:(e,n)=>{Object.keys(this.moex).forEach((e=>{this.portfolio.forEach((t=>{t.markets[e]=t.markets[e].filter((e=>e.positionId!==n.positionId))}))}))}},this.getters={getAllPortfolio:()=>this.portfolio,getPortfolio:e=>this.portfolio.filter((n=>n.name===e))[0],getPortfolioId:e=>this.portfolio.filter((n=>n.name===e))[0].id,getPortfolioById:e=>this.portfolio.filter((n=>n.id===e))[0],getPortfolioComm:e=>this.portfolio.filter((n=>n.name===e))[0].comm,getPortfolioSumm:e=>this.portfolio.filter((n=>n.id===e))[0].defaultSumm,getPortfolioDepo:e=>this.portfolio.filter((n=>n.name===e))[0].depo,getCategory:e=>this.portfolio.filter((n=>n.id===e))[0].defaultCategory,getPortfolioPositions:(e,n=this.defaultCategory)=>this.portfolio.filter((n=>n.name===e))[0].markets[n],getAllTickers:e=>{const n=[];return this.portfolio.forEach((t=>{t.markets[e].forEach((e=>n.push(e.ticker)))})),{[e]:n}},getPositionById:e=>{const n=Object.keys(this.moex);let t=null;return n.forEach((n=>{this.portfolio.forEach((r=>{r.markets[n].forEach((n=>{n.positionId===e&&(t=n)}))}))})),t},getPortfolioByPositionId:e=>this.getters.getPositionById(e).portfolioId,getCurrent:()=>this.currentPortfolio,getMoexSecurities:()=>this.moexSecurities,getMoexMarketData:()=>this.moexMarketData,getMoexByName:e=>{const n=e.toLocaleLowerCase();return this.moexSearch.moexSecurities.filter((e=>{const t=function(e){var n,t,r;return String(null!==(n=e[20])&&void 0!==n?n:"")+String(null!==(t=e[28])&&void 0!==t?t:"")+String(null!==(r=e[29])&&void 0!==r?r:"")}(e);return e[0].toLocaleLowerCase().includes(n)||e[2].toLocaleLowerCase().includes(n)||t.toLocaleLowerCase().includes(n)}))},getCurrency:e=>{const n=this.currency.filter((n=>n.id===e));return n&&n[0]?n[0].value:1},getMoexSearch:()=>this.moexSearch,getData_moex:(e,n,t)=>{const r={ticker:e,name:this.getters.getName_moex(e,n),fullname:this.getters.getFullName_moex(e,n),engname:this.getters.getEngName_moex(e,n),price:this.getters.getPrice_moex(e,n),startPrice:this.getters.getStartPrice_moex(e,n),currency:this.getters.getCurrency_moex(e,n),nominal:this.getters.getNominal_moex(e,n),nkd:this.getters.getNKD_moex(e,n)};return t.reduce(((e,n)=>(e[n]=r[n],e)),{})},getPrice_moex:(e,n)=>{const t=this.moexSearch.moexMarketData.filter((n=>n[0]===e))[0];return Number(t[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].priceIndex_1]?t[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].priceIndex_1]:t[{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].priceIndex_2])},getName_moex:(e,n)=>this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].nameIndex],getFullName_moex:(e,n)=>this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].fnameIndex],getEngName_moex:(e,n)=>this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].engnameIndex],getStartPrice_moex:(e,n)=>Number(this.moexSearch.moexMarketData.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].openPriceIndex]),getNKD_moex:(e,n)=>Number(this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].nkdIndex]),getCurrency_moex:(e,n)=>this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].currencyIndex],getCurrencyValue_moex:(e,n)=>this.getters.getCurrency(this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].currencyIndex])||1,getNominal_moex:(e,n)=>Number(this.moexSearch.moexSecurities.filter((n=>n[0]===e))[0][{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[n].nominalIndex])||1,getMoex:()=>this.moex},this.actions={initMoex:()=>$(this,void 0,void 0,(function*(){return this.marketList=Object.keys(this.moex),yield Promise.all(this.marketList.map((e=>$(this,void 0,void 0,(function*(){const n=this.getters.getAllTickers(e);if(n[e].length){const t=yield d(e,n[e]);return this.moex[e]=t.items,this.moexSecurities[e]=t.moexSecurities,this.moexMarketData[e]=t.moexMarketData,this.moex}}))))),Object.assign({},this.moex)})),initSearch:e=>$(this,void 0,void 0,(function*(){return this.moexSearch=yield d(e,[]),Object.assign({},this.moexSearch)})),initCurrency:()=>$(this,void 0,void 0,(function*(){return this.currency=yield async function(){return await fetch("//www.cbr-xml-daily.ru/daily_json.js").then((e=>e.json())).then((e=>Object.keys(e.Valute).map((n=>({id:n,value:e.Valute[n].Value}))))).catch((e=>(console.error("Ошибка при получении данных: ",e),[])))}(),[...this.currency]})),changeBroker:e=>{this.mutations.changeBroker(e)},addPosition:(e,n,t,r)=>{this.mutations.addPosition(e,n,t,r)},editPosition:(e,n)=>{this.mutations.editPosition(e,n)},deletePosition:(e,n)=>{this.mutations.deletePosition(e,n)},salePosition:(e,n)=>{this.mutations.salePosition(e,n)}},this.portfolio=E.portfolio,this.defaultPortfolio=this.portfolio[0].id,this.defaultCategory=this.portfolio[0].defaultCategory,this.currency=[],this.moex={TQBR:[],TQCB:[],TQOB:[]},this.moexSecurities={TQBR:[],TQCB:[],TQOB:[]},this.moexMarketData={TQBR:[],TQCB:[],TQOB:[]},this.moexSearch={TQBR:[],TQCB:[],TQOB:[]},this.currentPortfolio=[]}}const E={moex:[],portfolio:[{id:"1",name:"СберБрокер (спекулятивный)",depo:45e4,comm:.09,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[{positionId:"1",portfolioId:"1",ticker:"HYDR",type:"stock",market:"TQBR",buyPrice:.567,count:416e3,myStop:0}],TQCB:[],TQOB:[]}},{id:"2",name:"ИИС СберБрокер (среднесрочный)",depo:2e5,comm:.09,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[{positionId:"2",portfolioId:"2",ticker:"ASTR",type:"stock",market:"TQCB",buyPrice:510,count:178},{positionId:"3",portfolioId:"2",ticker:"SNGSP",type:"stock",market:"TQCB",buyPrice:42,count:1e3,myStop:0}],TQCB:[],TQOB:[]}},{id:"3",name:"Финам (долгосрочный)",depo:5e5,comm:.095,defaultSumm:5e4,defaultCategory:"TQBR",markets:{TQBR:[],TQCB:[{positionId:"6",portfolioId:"3",ticker:"RU000A105A95",type:"bonds",market:"TQCB",nkd:10,buyPrice:110,count:1,nominal:1e3,currency:"USD",buyCurrency:90},{positionId:"7",portfolioId:"3",ticker:"RU000A107B43",type:"bonds",market:"TQCB",nkd:13,buyPrice:84,count:2,nominal:1e3,currency:"USD",buyCurrency:92},{positionId:"8",portfolioId:"3",ticker:"RU000A107B43",type:"bonds",nkd:11,market:"TQCB",buyPrice:84,count:1,nominal:1e3,currency:"USD",buyCurrency:88}],TQOB:[{positionId:"9",portfolioId:"3",ticker:"SU26238RMFS4",type:"bonds",market:"TQOB",buyPrice:55,count:50,nominal:1e3,currency:"",nkd:7}]}}]},M=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function*(){let n=e;for(;;)yield++n}()}();function O(e,n){const t=[];e.querySelector("tbody").innerHTML="",n.forEach((e=>{const n=function(e){let n='<tr class="border-b dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">';e.sort(((e,n)=>e.sort-n.sort));let t=0;return e.forEach((e=>{n+=R(e.render(),t),t+=1})),n+="</tr>",n}(e.props);t.push(n)})),e.querySelector("tbody").insertAdjacentHTML("afterbegin",t.join(""))}function R(e,n,t=!1,r=!1){let i=`<td class=" py-2 relative cursor-pointer font-medium text-gray-900 whitespace-nowrap dark:text-white ${t?"pl-2 pr-2 hover:text-[#00aff5] dark:hover:text-[#00aff5]":" px-2"}" data-sort="${n}" ${t?'data-header="asc"':""}>`;return i+=e,i+="</td>",i}class N extends I{constructor(e,n,t,r){super(e),this.selector=e,this.Component=n,this.items=t,this.emitter=r,this.init()}init(){this.instances=new this.Component(this.items)}render(){const e=document.querySelector(this.selector);e.insertAdjacentHTML("afterend",'<div class="table"></div>'),e.classList.remove("table"),e.classList.add("renderedTable");const n=e.appendChild(document.createElement("div")),t=function(e,n,t=null){const r=function(e){let n='<tr class="border-b dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">',t=0;return e.forEach((e=>{n+=R(e,t,!0),t+=1})),n+="</tr>",n}(n);let i=null;return t&&(i=function(e){let n='<tr class="border-b dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">',t=0;return e.forEach((e=>{n+=R(e,t,!1,!0),t+=1})),n+="</tr>",n}(t)),`\n    <section class="w-full dark:bg-gray-900 py-3 sm:py-5" id=table${M.next().value}>\n      <div class="w-full mx-auto max-w-screen-2xl">\n      <h2 class="text-2xl font-black">${L.portfolioName||""}</h2>\n        <div class="w-full relative bg-white shadow-md dark:bg-gray-800 sm:rounded-lg">\n        <table class="w-full">\n        <thead>${null!=r?r:""}</thead>\n        <tbody></tbody>\n        <tfoot>${null!=i?i:""}</tfoot>\n        </table>\n        </div>\n      </div>\n    </section>\n  `}(this.instances.components,this.instances.headers,this.instances.footers);n.innerHTML=t,O(e,this.instances.components),n.addEventListener("click",(n=>{this.sortTable(e,n)})),this.instances.components.forEach((e=>{e.props.forEach((e=>{e instanceof S&&e.initListeners(this.emitter)}))}))}sortTable(e,n){if(n.target instanceof HTMLElement){const t=n.target.getAttribute("data-header"),r=n.target.classList;t&&("asc"===t&&(this.sortAsc(Number(n.target.getAttribute("data-sort"))),n.target.setAttribute("data-header","desc"),r.remove("asc"),r.remove("desc"),r.add("desc")),"desc"===t&&(this.sortDesc(Number(n.target.getAttribute("data-sort"))),n.target.setAttribute("data-header","asc"),r.remove("asc"),r.remove("desc"),r.add("asc")),this.toggleClassEl(n.target,".sorted","sorted"),O(e,this.instances.components))}}sortAsc(e){this.instances.components.sort(((n,t)=>n.props[e].sortField-t.props[e].sortField))}sortDesc(e){this.instances.components.sort(((n,t)=>t.props[e].sortField-n.props[e].sortField))}}class D{constructor(){this.props=[]}}class F extends k{constructor(e,n,t,r){super(r),this.startValue=e,this.currentValue=n,this.count=t,this.value=Number(((this.currentValue-this.startValue)*this.count).toFixed(2)),this.percent=Number((this.value/(this.startValue*this.count)*100).toFixed(2))}render(){let e="";return e=this.percent>0?"text-green-500":this.percent<0?"text-red-500":"text-slate-400",`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white ${e}">${s(this.value)}</span>\n          </span>\n          <span>\n            <span class="block  bg-primary-100 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300 ${e}">${s(this.percent)}%</span>\n            </span>  \n      </div>\n    `}}class q extends k{constructor(e=null,n){super(n),this.value=e}render(){let e=null;return e=this.value?s(this.value.toFixed(2))+" ₽":"-",`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-normal text-gray-900 whitespace-nowrap dark:text-white">${e}</span>\n          </span>\n        \n      </div>\n    `}}class A extends k{constructor(e=1,n){super(n),this.count=e}render(){let e="";return this.count>0&&(e=`<div class="">\n      <span class="w-auto block mr-3">\n      <span class="block font-normal text-gray-900 whitespace-nowrap dark:text-white">${s(this.count)} шт. </span>\n      </span>\n     \n  </div>`),e}}class V extends k{constructor(e=null,n=null,t,r=0){super(t),this.single=e,this.count=n,this.total=this.single*this.count,r&&(this.total+=r),this.total=Number(this.total.toFixed(2))}render(){return`\n      <div class="">\n          <span class="w-auto block mr-3">\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.total?s(this.total)+" ₽":""}</span>          </span>\n          <span>\n            <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${s(this.single.toFixed(2))} ₽</span>\n            </span>  \n      </div>\n    `}}class j{constructor(e){this.headers=["Актив","Кол-во","Средняя цена","НКД","Комиссия","Вложено","Стоимость","Прибыль","",""],this.footers=[],this.props=["stock","count","startPrice","nkd","comm","startTotal","currentPrice","change","positionControl"],this.components=[],this.init(e)}init(e){e.forEach((e=>{if(e){const n=new D;Object.keys(e).forEach((t=>{const r=this.props.indexOf(t);if(r>-1){const i=e[t];this.initSortfield(e[t],i,r),n.props.push(i)}})),this.components.push(n)}})),this.initFooters(e)}initSortfield(e,n,t){n.sort=t,e instanceof q&&(n.sortField=e.value),e instanceof V&&(n.sortField=e.total),e instanceof A&&(n.sortField=e.count),e instanceof A&&(n.sortField=e.count),e instanceof F&&(n.sortField=e.value)}initFooters(e){this.footers.push("Всего"),this.footers.push(this.calcCount(e)+" шт."),this.footers.push(""),this.footers.push(this.calcBuy(e)+" ₽"),this.footers.push(this.calcCurrent(e)+" ₽"),this.footers.push(this.calcChange(e))}calcCount(e){let n=0;return e.forEach((e=>{n+=e.count.count})),s(n)}calcBuy(e){let n=0;return e.forEach((e=>{n+=e.startPrice.value*e.count.count})),s(n.toFixed(2))}calcCurrent(e){let n=0;return e.forEach((e=>{n+=e.currentPrice.total})),s(n.toFixed(2))}calcChange(e){let n=0,t=0,r=0;return e.forEach((e=>{n+=e.change.currentValue*e.count.count-e.change.startValue*e.count.count,r+=e.change.startValue*e.count.count})),t=n/r*100,`<span class="${n>0?"text-green-500":"text-red-500"}">\n      ${s(n.toFixed(2))} ₽\n      (${s(t.toFixed(2))} %)\n    </span>`}}class H extends k{constructor(e,n,t){super(n),this.ticker=e;const r=this.options.getters.getMoex()[t].filter((n=>n.ticker===e))[0];this.name=r.name,this.currentPrice=r.price,this.dayChange=r.open-r.price,this.logo=`https://mybroker.storage.bcs.ru/FinInstrumentLogo/${e}.png`}render(){return`\n    <div class="">\n      <a href="#" target="_blank" class="flex items-center">\n        <span class="w-auto h-8 mr-3 ">\n          <img src=${this.logo} width="40" width="40" height="40" class="min-w-[40px] rounded-full">\n        </span>\n        <span>\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.name}</span>\n          <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${this.ticker}</span>\n          </span>  \n      </a>\n    </div>\n  `}}class U extends k{constructor(e,n,t,r,i){super(r),this.ticker=e;const o=this.options.getters.getMoex()[i].filter((n=>n.ticker===e))[0];this.name=o.name,this.currentPrice=o.price*o.nominal/100,this.dayChange=o.open-o.price,this.logo="TQOB"===i?`https://mybroker.storage.bcs.ru/FinInstrumentLogo/${r.moexSecurities[i].filter((n=>n[0]===e))[0][28]}.png`:`https://mybroker.storage.bcs.ru/FinInstrumentLogo/${e}.png`,this.initData(t,o,n)}initData(e,n,t){return r=this,i=void 0,d=function*(){e&&e.length&&this.options.getters.getCurrency(e)&&(this.currentPrice=this.currentPrice*this.options.getters.getCurrency(e))},new((o=void 0)||(o=Promise))((function(e,n){function t(e){try{s(d.next(e))}catch(e){n(e)}}function a(e){try{s(d.throw(e))}catch(e){n(e)}}function s(n){var r;n.done?e(n.value):(r=n.value,r instanceof o?r:new o((function(e){e(r)}))).then(t,a)}s((d=d.apply(r,i||[])).next())}));var r,i,o,d}render(){return`\n    <div class="">\n      <a href="#" target="_blank" class="flex items-center">\n        <span class="w-auto h-8 mr-3 ">\n          <img src=${this.logo} width="40" width="40" height="40" class="min-w-[40px] rounded-full">\n        </span>\n        <span>\n          <span class="block font-medium text-gray-900 whitespace-nowrap dark:text-white">${this.name}</span>\n          <span class="block  bg-primary-100 text-slate-400 text-xs font-medium rounded dark:bg-primary-900 dark:text-primary-300">${this.ticker}</span>\n          </span>  \n      </a>\n    </div>\n  `}}class z{constructor(e,n,t,r,i,o,d,a,s=null,c=null,l=0,u=1,m,x,h,p){this.options=m,this.type=t,"stock"===this.type&&(this.stock=new H(e,m,n)),"bonds"===this.type&&(this.stock=new U(e,o,d,m,n)),r=r*(o?o/100:1)*(a||1),this.startPrice=new q(r,m),this.change=new F(r,this.stock.currentPrice,i,m),this.nominal=o,this.count=new A(i,m),this.currentPrice=new V(this.stock.currentPrice,i,m),this.myStop=new q(s,m),this.salePrice=new V(c,null,m),this.comm=this.startPrice.value*i*u/100,this.nkd=l*i;const I=Number(l*i+Number(this.comm));this.comm=new q(this.comm,m),this.nkd=new q(this.nkd,m),this.startTotal=new V(r,i,m,I),this.positionControl=new S({positionId:x,portfolioId:h,marketId:p},m)}static createPosition(e,n,t,r,i){const o=[];return e.forEach((e=>{e.isSold||o.push(new z(e.ticker,i,t,e.buyPrice,e.count,e.nominal,e.currency,e.buyCurrency,e.myStop,null,e.nkd,r,n,e.positionId,e.portfolioId,i))})),o}}class Z{constructor(e,n,t,r=[],i){this.id=e,this.name=n,this.depo=t,this.positions=r,this.comm=i}buyStock(e){this.positions.push(e)}}class W extends i{constructor(e,n){super(e,Object.assign({listeners:[]},n)),this.emitter=n.emitter,this.state=n.state,this.unsubs=[]}init(){const e=this.state.getters.getAllPortfolio();this.createTable(e),this.$on("table:changeBroker",(e=>{this.changeBroker(e)})),this.$on("table:showAllBrokers",(()=>{this.changeBroker()}))}toHTML(){return'\n      <div class="table"></div>\n    '}createTable(e){e.forEach((e=>{let n=[];L.portfolioName=e.name,this.state.marketList.forEach((t=>{const r=function(e){return{TQBR:{type:"stock",market:"TQBR",priceIndex_1:2,priceIndex_2:3,nominalIndex:-1,currencyIndex:16,tickerIndex:0,nameIndex:2,fnameIndex:9,engnameIndex:20,openPriceIndex:9,nkdIndex:null},TQCB:{type:"bonds",market:"TQCB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7},TQOB:{type:"bonds",market:"TQOB",priceIndex_1:3,priceIndex_2:8,nominalIndex:38,currencyIndex:25,tickerIndex:0,nameIndex:2,fnameIndex:19,engnameIndex:29,openPriceIndex:8,nkdIndex:7}}[e].type}(t);if(e.markets[t]&&e.markets[t].length){const i=new Z(e.id,e.name,e.depo,z.createPosition(e.markets[t],this.state,r,e.comm,t),e.comm);n=n.concat(i.positions)}})),new N(".table",j,n,this.emitter).render()}))}changeBroker(e){if(document.querySelectorAll(".renderedTable").forEach((e=>{e.innerHTML=""})),e)this.state.actions.changeBroker(String(e)),this.createTable(this.state.currentPortfolio);else{const e=this.state.getters.getAllPortfolio();this.createTable(e)}}}W.id="tableblock";const K=new L;!function(){var e,n,t,r;e=this,n=void 0,r=function*(){K.moex=yield K.actions.initMoex(),K.currency=yield K.actions.initCurrency(),new f("#app",{components:[p,W,y],state:K}).render()},new((t=void 0)||(t=Promise))((function(i,o){function d(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((r=r.apply(e,n||[])).next())}))}()})();